---
title: "Analysis and Figures"
author: "Samuel R.P-J. Ross"
date: '2022-07-08'
output: html_document
---

```{r setup, include=FALSE, echo=FALSE}
knitr::opts_chunk$set(echo = TRUE)

## Packages:
library(nlme)
library(patchwork)
library(here)
library(brms)
library(tidybayes)
library(cowplot)
library(ape)
library(dbplyr)
library(tidyverse)

# get data
load(here("Data/Stability_Acoustic_Indices.rda"))
load(here("Data/Stability_Species_Detections.rda"))

# get site names ordered by land use PC1 for later use in figures
load(here("Data/all_landuse.rda"))
Site_order<-Landuse_1000$site_id[order(Landuse_1000$PC1)]
rm(Landuse_1000)
```

This markdown is for building models to test effects of land use and typhoons on acoustic indices and bird species detections. 
Modeling framework uses Bayesian models to test for effects of typhoons and land use (plus their interaction) on means and variabilities of acoustic indices and bird detections. Also tests land use effect on acoustic index resistance and recovery.
Can test for spatial autocorrelation of model residuals and fit spatial error terms where needed.

### Acoustic indices

## acoustic index mean states

**NDSI - negative change after typhoon**

```{r}

# get pre vs post data for comparison
dat_pre<-tidy.stability_AI %>%
  filter(Index %in% "NDSI" & response_variable %in% 'Pre_mean') 
dat_post<-tidy.stability_AI %>%
  filter(Index %in% "NDSI" & response_variable %in% 'Post_mean')
dat_pre<-dat_pre[complete.cases(dat_pre),]
dat_post<-dat_post[complete.cases(dat_post),]
dat_pre$Typhoon = rep("Pre", nrow(dat_pre))
dat_post$Typhoon = rep("Post", nrow(dat_post))
df <- rbind(dat_pre, dat_post)
#names(df)[1] <- names(Landuse_1000)[1]
#df <- left_join(df, Landuse_1000, by = "site_id")

# change levels for model
df$Landuse<-df$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
df$Typhoon<-df$Typhoon %>% parse_character() %>% parse_factor(levels = c('Pre','Post'))
#df$site_id<-df$site_id %>% parse_character() %>% parse_factor(levels = c(df$site_id[order(df$PC1)]))

mod_nonspatial_beta <- 
  brm(data = df, family = Beta(),
      Stability ~ 1 + Landuse * Typhoon + (1|Site_ID),
      iter = 5e4, warmup = 5000, chains = 4, cores = 4, thin = 2,
      seed = 666)
mod_nonspatial_beta <- add_criterion(mod_nonspatial_beta, "loo")

#check MCMC traces
mcmc_plot(mod_nonspatial_beta, type = "trace") + theme_cowplot()
#check for agreement of chains
mcmc_plot(mod_nonspatial_beta, type = "dens_overlay") + theme_cowplot()
# plot posterior estimates of fixed effects
mcmc_plot(mod_nonspatial_beta, type = "intervals",prob = 0.68, prob_outer = 0.95, variable = "^b_", regex = TRUE) + theme_cowplot()

## typhoon has an effect ##

mut_mod<-mod_nonspatial_beta %>%
  spread_draws(b_TyphoonPost, r_Site_ID[Site_ID,]) %>%
  mutate(site_mean = b_TyphoonPost + r_Site_ID) # get posterior distribution data for plotting

# determine whether credible intervals span zero, and store as binary (to show in plot): 
mut_mod$sig<-0
for (i in 1:length(unique(mut_mod$Site_ID))) {
  temp<-mut_mod$site_mean[mut_mod$Site_ID %in% mut_mod$Site_ID[i]] %>% 
    quantile(c(0.05,0.95)) %>% # get 95% credible intervals
    sign() %>% # get sign of those intervals
    duplicated() # are the signs identical (no = zero-spanning)
  if(temp[2] %in% TRUE){ # if signs are identical (non-zero-spanning)
    mut_mod$sig[mut_mod$Site_ID %in% mut_mod$Site_ID[i]]<-1 # add significance indicator
  }
}
rm(temp)
mut_mod$sig<-mut_mod$sig %>% as.character() %>% parse_factor(levels = c('0','1')) # convert to factor

# plot posterior typhoon effect
mut_mod %>%
  ggplot(aes(y = Site_ID %>% as.character %>% parse_factor(levels = Site_order), 
             x = site_mean, 
             fill = stat(x) > 0,
             shape = sig)) + 
  stat_halfeye(show.legend = F) +
  geom_vline(xintercept = 0, 
             linetype = "dashed") +
  scale_fill_manual(values = c("skyblue","gray80")) +
  scale_shape_manual(values = c(1,8)) +
  labs(x = "Posterior distribution (typhoon effect)",
       y = "Site") + 
  cowplot::theme_minimal_grid(font_size = 14,
                              colour = "grey92")




## Parameter fits and stats 

mod_nonspatial_beta$fit # Rhat values closer to 1 and n_eff values > 1000 are ideal.
bayes_R2(mod_nonspatial_beta) # pseudo r-squared of model
# simulate data from 500 random draws of posterior and compare it to observed data
# the black line should run through the center of the blue lines
pp_check(mod_nonspatial_beta, ndraws = 500) + theme_cowplot()

## Spatial Autocorrelation test
bres <- residuals(mod_nonspatial_beta)[,"Estimate"]
d_mat = as.matrix(dist(df[,c("Lat", "Long")], diag=T, upper=T)) # make distance matrix 
d_mat_inv <- 1/d_mat
d_mat_inv[which(d_mat_inv == Inf)] <- 0
Moran.I(bres, d_mat_inv) # non-significant = no spatial autocorrelation

```







Here we have run the stability calculations in another R markdown and pulled the results in here. We will run the following analyses, first on three different acoustic indices (NDSI, NDSI_Bio, NDSI_Anthro), then for our species detections:

*NDSI* / *NDSI_Bio* / *NDSI_Anthro*
-Time period: Baseline vs post-typhoon (X)
-Baseline vs Landuse (X)
-Post-typhoon vs Landuse (X)
-Temporal Stability vs Landuse (X)
-Resistance vs Landuse (X)
-Recovery Speed vs Landuse (X)
-Resilience vs Landuse (X)
-Extent of Change vs Landuse (X)
-Spatial Var vs time period (X)
-Spatial Var vs Landuse (X)
-Spatial Var vs time period x Landuse (X)

*Species Detections*
-Baseline vs Landuse (X)
-Post-typhoon vs Landuse (X)
-Temporal Stability vs Landuse (X)
-Extent of Change vs Landuse (X)
-Baseline vs Species (X)
-Post-typhoon vs Species (X)
-Temporal Stability vs Species (X)
-Extent of Change vs Species (X)
-Spatial Var vs time period (X)
-Spatial Var vs Landuse (X)
-Spatial Var vs time period x Landuse (X)

We'll analyse the data using a bootstrapping approach to compare means in a way that better accounts for non-normality etc. We have the landuse groups and other variables to split our datasets by, so we can bootstrap the means 10,000 times to get a distribution of means for each group. Then we'll use 95% confidence intervals to ask whether the groups differ significantly; if the groups have non-overlapping confidence intervals, then the group means differ significantly. We'll achieve this using the one.boot() function in the _simpleboot_ package.

We'll visualise both the raw data and the 95% confidence intervals of the bootstrapped means to show our results. 

We'll begin with the acoustic indices:

### Acoustic Indices

## Time period

```{r}
# subset dataframe
dat_pre<-tidy.stability_AI %>%
  filter(Index %in% "NDSI" & Stability_dimension %in% 'Baseline') 
dat_post<-tidy.stability_AI %>%
  filter(Index %in% "NDSI" & Stability_dimension %in% 'Mean_post')
dat_pre<-dat_pre[complete.cases(dat_pre),]
dat_post<-dat_post[complete.cases(dat_post),]

# bootstrap group means & order results
boot_pre<-dat_pre$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_pre<-boot_pre$t %>% sort()
boot_post<-dat_post$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_post<-boot_post$t %>% sort()

# combine data
dat_sim<-tibble('Pre-typhoon' = boot_pre[c(501:9500)], # choose only 95% CIs
                'Post-typhoon' = boot_post[c(501:9500)]) %>%  
  pivot_longer(cols = c('Pre-typhoon','Post-typhoon'),names_to = "Period",values_to = "Bootstrap")
dat_raw<-tibble('Pre-typhoon' = dat_pre$Stability,'Post-typhoon' = dat_post$Stability) %>%  
  pivot_longer(cols = c('Pre-typhoon','Post-typhoon'),names_to = "Period",values_to = "Stability")

# convert to factor
dat_raw$Period<-dat_raw$Period %>% parse_character() %>% parse_factor(levels = c('Pre-typhoon','Post-typhoon'))
dat_sim$Period<-dat_sim$Period %>% parse_character() %>% parse_factor(levels = c('Pre-typhoon','Post-typhoon'))

# Analysis
dat_sim %>% 
  filter(Period == 'Pre-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Period == 'Post-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Period",y = "Mean Normalised Difference Soundscape Index") + 
  geom_point(mapping = aes(x = Period, y=Stability,
                           shape = Period),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Period, y=Stability,
                             fill = Period),
                       alpha = 0.6) +
  scale_color_manual(values = c('#00B2EE','#EE6AA7'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Period),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#00B2EE','#EE6AA7'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_a<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_a
```

No effect on NDSI.

```{r}
# subset dataframe
dat_pre<-tidy.stability_AI %>%
  filter(Index %in% "NDSI_Bio" & Stability_dimension %in% 'Baseline') 
dat_post<-tidy.stability_AI %>%
  filter(Index %in% "NDSI_Bio" & Stability_dimension %in% 'Mean_post')
dat_pre<-dat_pre[complete.cases(dat_pre),]
dat_post<-dat_post[complete.cases(dat_post),]

# bootstrap group means & order results
boot_pre<-dat_pre$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_pre<-boot_pre$t %>% sort()
boot_post<-dat_post$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_post<-boot_post$t %>% sort()

# combine data
dat_sim<-tibble('Pre-typhoon' = boot_pre[c(501:9500)], # choose only 95% CIs
                'Post-typhoon' = boot_post[c(501:9500)]) %>%  
  pivot_longer(cols = c('Pre-typhoon','Post-typhoon'),names_to = "Period",values_to = "Bootstrap")
dat_raw<-tibble('Pre-typhoon' = dat_pre$Stability,'Post-typhoon' = dat_post$Stability) %>%  
  pivot_longer(cols = c('Pre-typhoon','Post-typhoon'),names_to = "Period",values_to = "Stability")

# convert to factor
dat_raw$Period<-dat_raw$Period %>% parse_character() %>% parse_factor(levels = c('Pre-typhoon','Post-typhoon'))
dat_sim$Period<-dat_sim$Period %>% parse_character() %>% parse_factor(levels = c('Pre-typhoon','Post-typhoon'))

# Analysis
dat_sim %>% 
  filter(Period == 'Pre-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Period == 'Post-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Period",y = "Mean Biophony") + 
  geom_point(mapping = aes(x = Period, y=Stability,
                           shape = Period),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Period, y=Stability,
                             fill = Period),
                       alpha = 0.6) +
  scale_color_manual(values = c('#00B2EE','#EE6AA7'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Period),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#00B2EE','#EE6AA7'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_b<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
#rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_b
```

No effect on biophony

```{r}
# subset dataframe
dat_pre<-tidy.stability_AI %>%
  filter(Index %in% "NDSI_Anth" & Stability_dimension %in% 'Baseline') 
dat_post<-tidy.stability_AI %>%
  filter(Index %in% "NDSI_Anth" & Stability_dimension %in% 'Mean_post')
dat_pre<-dat_pre[complete.cases(dat_pre),]
dat_post<-dat_post[complete.cases(dat_post),]

# bootstrap group means & order results
boot_pre<-dat_pre$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_pre<-boot_pre$t %>% sort()
boot_post<-dat_post$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_post<-boot_post$t %>% sort()

# combine data
dat_sim<-tibble('Pre-typhoon' = boot_pre[c(501:9500)], # choose only 95% CIs
                'Post-typhoon' = boot_post[c(501:9500)]) %>%  
  pivot_longer(cols = c('Pre-typhoon','Post-typhoon'),names_to = "Period",values_to = "Bootstrap")
dat_raw<-tibble('Pre-typhoon' = dat_pre$Stability,'Post-typhoon' = dat_post$Stability) %>%  
  pivot_longer(cols = c('Pre-typhoon','Post-typhoon'),names_to = "Period",values_to = "Stability")

# convert to factor
dat_raw$Period<-dat_raw$Period %>% parse_character() %>% parse_factor(levels = c('Pre-typhoon','Post-typhoon'))
dat_sim$Period<-dat_sim$Period %>% parse_character() %>% parse_factor(levels = c('Pre-typhoon','Post-typhoon'))

# Analysis
dat_sim %>% 
  filter(Period == 'Pre-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Period == 'Post-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Period",y = "Mean Anthropophony") + 
  geom_point(mapping = aes(x = Period, y=Stability,
                           shape = Period),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Period, y=Stability,
                             fill = Period),
                       alpha = 0.6) +
  scale_color_manual(values = c('#00B2EE','#EE6AA7'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Period),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#00B2EE','#EE6AA7'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_c<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
#rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_c
```

Significant post-typhoon increase in anthropophony across sites.

# Multipanel figure

```{r}
Panel_a / Panel_b / Panel_c
rm(Panel_a,Panel_b,Panel_c)
```



## NDSI

# Baseline vs Landuse

```{r}
# subset dataframe
dat_f<-tidy.stability_AI %>%
  filter(Index %in% "NDSI" & Stability_dimension %in% 'Baseline' & kmeans %in% 'Forest') 
dat_d<-tidy.stability_AI %>%
  filter(Index %in% "NDSI" & Stability_dimension %in% 'Baseline' & kmeans %in% 'Developed')
dat_f<-dat_f[complete.cases(dat_f),]
dat_d<-dat_d[complete.cases(dat_d),]

# bootstrap group means & order results
boot_f<-dat_f$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f<-boot_f$t %>% sort()
boot_d<-dat_d$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d<-boot_d$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f[c(501:9500)], # choose only 95% CIs
                Developed = boot_d[c(501:9500)]) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_raw<-tibble(Developed = dat_d$Stability,Forest = c(dat_f$Stability,NA,NA,NA,NA)) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "Pre-typhoon baseline") + 
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Landuse),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Landuse),
                       alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_a<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_a
```

No difference.

# Post-typhoon vs Landuse

```{r}
# subset dataframe
dat_f<-tidy.stability_AI %>%
  filter(Index %in% "NDSI" & Stability_dimension %in% 'Mean_post' & kmeans %in% 'Forest') 
dat_d<-tidy.stability_AI %>%
  filter(Index %in% "NDSI" & Stability_dimension %in% 'Mean_post' & kmeans %in% 'Developed')
dat_f<-dat_f[complete.cases(dat_f),]
dat_d<-dat_d[complete.cases(dat_d),]

# bootstrap group means & order results
boot_f<-dat_f$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f<-boot_f$t %>% sort()
boot_d<-dat_d$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d<-boot_d$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f[c(501:9500)], # choose only 95% CIs
                Developed = boot_d[c(501:9500)]) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_raw<-tibble(Developed = dat_d$Stability,Forest = c(dat_f$Stability,NA,NA,NA,NA)) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "Post-typhoon index value") + 
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Landuse),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Landuse),
                       alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_b<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_b
```

No difference.

# Temporal Stability vs Landuse

```{r}
# subset dataframe
dat_f<-tidy.stability_AI %>%
  filter(Index %in% "NDSI" & Stability_dimension %in% 'Temp_Var' & kmeans %in% 'Forest') 
dat_d<-tidy.stability_AI %>%
  filter(Index %in% "NDSI" & Stability_dimension %in% 'Temp_Var' & kmeans %in% 'Developed')
dat_f<-dat_f[complete.cases(dat_f),]
dat_d<-dat_d[complete.cases(dat_d),]

# bootstrap group means & order results
boot_f<-dat_f$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f<-boot_f$t %>% sort()
boot_d<-dat_d$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d<-boot_d$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f[c(501:9500)], # choose only 95% CIs
                Developed = boot_d[c(501:9500)]) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_raw<-tibble(Developed = dat_d$Stability,Forest = c(dat_f$Stability,NA,NA,NA,NA)) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "1 - Temporal Variability") + 
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Landuse),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Landuse),
                       alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity",alpha = 0.5) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_c<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_c
```

No difference.

# Resistance vs Landuse

```{r}
# subset dataframe
dat_f<-tidy.stability_AI %>%
  filter(Index %in% "NDSI" & Stability_dimension %in% 'Resist' & kmeans %in% 'Forest') 
dat_d<-tidy.stability_AI %>%
  filter(Index %in% "NDSI" & Stability_dimension %in% 'Resist' & kmeans %in% 'Developed')
dat_f<-dat_f[complete.cases(dat_f),]
dat_d<-dat_d[complete.cases(dat_d),]

# bootstrap group means & order results
boot_f<-dat_f$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f<-boot_f$t %>% sort()
boot_d<-dat_d$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d<-boot_d$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f[c(501:9500)], # choose only 95% CIs
                Developed = boot_d[c(501:9500)]) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_raw<-tibble(Developed = dat_d$Stability,Forest = c(dat_f$Stability,NA,NA,NA,NA,NA)) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "Resistance") + 
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Landuse),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Landuse),
                       alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_d<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_d
```

No difference.

# Recovery vs Landuse

```{r}
# subset dataframe
dat_f<-tidy.stability_AI %>%
  filter(Index %in% "NDSI" & Stability_dimension %in% 'Recov_time' & kmeans %in% 'Forest') 
dat_d<-tidy.stability_AI %>%
  filter(Index %in% "NDSI" & Stability_dimension %in% 'Recov_time' & kmeans %in% 'Developed')
dat_f<-dat_f[complete.cases(dat_f),]
dat_d<-dat_d[complete.cases(dat_d),]

# bootstrap group means & order results
boot_f<-dat_f$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f<-boot_f$t %>% sort()
boot_d<-dat_d$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d<-boot_d$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f[c(501:9500)], # choose only 95% CIs
                Developed = boot_d[c(501:9500)]) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_raw<-tibble(Developed = dat_d$Stability,Forest = c(dat_f$Stability,NA,NA,NA,NA,NA,NA)) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "Recovery Speed") + 
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Landuse),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Landuse),
                       alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_e<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_e
```

No difference.

# Resilience vs Landuse

```{r}
# subset dataframe
dat_f<-tidy.stability_AI %>%
  filter(Index %in% "NDSI" & Stability_dimension %in% 'Resil' & kmeans %in% 'Forest') 
dat_d<-tidy.stability_AI %>%
  filter(Index %in% "NDSI" & Stability_dimension %in% 'Resil' & kmeans %in% 'Developed')
dat_f<-dat_f[complete.cases(dat_f),]
dat_d<-dat_d[complete.cases(dat_d),]

# bootstrap group means & order results
boot_f<-dat_f$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f<-boot_f$t %>% sort()
boot_d<-dat_d$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d<-boot_d$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f[c(501:9500)], # choose only 95% CIs
                Developed = boot_d[c(501:9500)]) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_raw<-tibble(Developed = dat_d$Stability,Forest = c(dat_f$Stability,NA,NA,NA,NA,NA,NA)) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "Resilience") + 
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Landuse),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Landuse),
                       alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_f<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_f
```

No difference.

# Extent of Change vs Landuse

```{r}
# subset dataframe
dat_f<-tidy.stability_AI %>%
  filter(Index %in% "NDSI" & Stability_dimension %in% 'Ext_Chng' & kmeans %in% 'Forest') 
dat_d<-tidy.stability_AI %>%
  filter(Index %in% "NDSI" & Stability_dimension %in% 'Ext_Chng' & kmeans %in% 'Developed')
dat_f<-dat_f[complete.cases(dat_f),]
dat_d<-dat_d[complete.cases(dat_d),]

# bootstrap group means & order results
boot_f<-dat_f$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f<-boot_f$t %>% sort()
boot_d<-dat_d$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d<-boot_d$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f[c(501:9500)], # choose only 95% CIs
                Developed = boot_d[c(501:9500)]) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_raw<-tibble(Developed = dat_d$Stability,Forest = c(dat_f$Stability,NA,NA,NA,NA)) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")
dat_sig<-tibble(Developed = dat_d$p_sig,Forest = c(dat_f$p_sig,NA,NA,NA,NA)) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Sig")
dat_raw<-dat_raw %>% add_column(Sig = dat_sig$Sig); rm(dat_sig)

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_raw$Sig<-dat_raw$Sig %>% as.character() %>% parse_factor(levels = c('0','1'),include_na = F)

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "Extent of Change") + 
  geom_hline(yintercept = 0,lty = 2,alpha=0.5) +
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Sig),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Landuse),
                       alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_shape_manual(values = c(2,8)) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_hline(yintercept = 0,lty = 2,alpha=0.5) +
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_g<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_g
```

No difference.

# Multipanel figure

```{r}
(Panel_a | Panel_b) / (Panel_c | Panel_d) / (Panel_e | Panel_g) #/ (Panel_f | plot_spacer())
rm(Panel_a,Panel_b,Panel_c,Panel_d,Panel_e,Panel_f,Panel_g)
```

# Spatial Variability vs time period

```{r}
# subset dataframe
dat_pre<-tidy.spatial_AI %>%
  filter(Index %in% "NDSI" & Stability_dimension %in% 'Spatial_Var' & Period %in% 'Pre-typhoon') 
dat_post<-tidy.spatial_AI %>%
  filter(Index %in% "NDSI" & Stability_dimension %in% 'Spatial_Var' & Period %in% 'Post-typhoon')
dat_pre<-dat_pre[complete.cases(dat_pre),]
dat_post<-dat_post[complete.cases(dat_post),]

# bootstrap group means & order results
boot_pre<-dat_pre$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_pre<-boot_pre$t %>% sort()
boot_post<-dat_post$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_post<-boot_post$t %>% sort()

# combine data
dat_sim<-tibble('Pre-typhoon' = boot_pre[c(501:9500)], # choose only 95% CIs
                'Post-typhoon' = boot_post[c(501:9500)]) %>%  
  pivot_longer(cols = c('Pre-typhoon','Post-typhoon'),names_to = "Period",values_to = "Bootstrap")
dat_raw<-tibble('Pre-typhoon' = dat_pre$Stability,
                'Post-typhoon' = dat_post$Stability) %>%  
  pivot_longer(cols = c('Pre-typhoon','Post-typhoon'),names_to = "Period",values_to = "Stability")

# convert to factor
dat_raw$Period<-dat_raw$Period %>% parse_character() %>% parse_factor(levels = c('Pre-typhoon','Post-typhoon'))
dat_sim$Period<-dat_sim$Period %>% parse_character() %>% parse_factor(levels = c('Pre-typhoon','Post-typhoon'))

# Analysis
dat_sim %>% 
  filter(Period == 'Pre-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Period == 'Post-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Typhoon Period",y = "Spatial Variability") + 
  geom_point(mapping = aes(x = Period, y=Stability,
                           shape = Period),
                     position = position_jitter(width = 0.35),
                     size = 2, alpha = 0.1,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Period, y=Stability,
                             fill = Period),
                       alpha = 0.6) +
  scale_color_manual(values = c('#00B2EE','#EE6AA7'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Period),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#00B2EE','#EE6AA7'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_a<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_pre,boot_post,dat_pre,dat_post,dat_raw,dat_sim)
Panel_a
```

Spatial variability higher after typhoons.

# Spatial Variability vs land use

```{r}
# subset dataframe
dat_f<-tidy.spatial_AI %>%
  filter(Index %in% "NDSI" & Stability_dimension %in% 'Forest_Var' & Period %in% c('Pre-typhoon','Post-typhoon'))
dat_d<-tidy.spatial_AI %>%
  filter(Index %in% "NDSI" & Stability_dimension %in% 'Developed_Var' & Period %in% c('Pre-typhoon','Post-typhoon'))
dat_f<-dat_f[complete.cases(dat_f),]
dat_d<-dat_d[complete.cases(dat_d),]

# bootstrap group means & order results
boot_f<-dat_f$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f<-boot_f$t %>% sort()
boot_d<-dat_d$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d<-boot_d$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f[c(501:9500)], # choose only 95% CIs
                Developed = boot_d[c(501:9500)]) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_raw<-tibble(Forest = dat_f$Stability,
                Developed = dat_d$Stability) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "Spatial Variability") + 
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Landuse),
                     position = position_jitter(width = 0.35),
                     size = 2, alpha = 0.1,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Landuse),
                       alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_b<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_b
```

Spatial variability higher among developed sites.

# Spatial Variability vs Time period x Landuse

```{r}
# subset dataframe
dat_f_pre<-tidy.spatial_AI %>%
  filter(Index %in% "NDSI" & Stability_dimension %in% 'Forest_Var' & Period %in% c('Pre-typhoon'))
dat_f_post<-tidy.spatial_AI %>%
  filter(Index %in% "NDSI" & Stability_dimension %in% 'Forest_Var' & Period %in% c('Post-typhoon'))
dat_d_pre<-tidy.spatial_AI %>%
  filter(Index %in% "NDSI" & Stability_dimension %in% 'Developed_Var' & Period %in% c('Pre-typhoon'))
dat_d_post<-tidy.spatial_AI %>%
  filter(Index %in% "NDSI" & Stability_dimension %in% 'Developed_Var' & Period %in% c('Post-typhoon'))
dat_f_pre<-dat_f_pre[complete.cases(dat_f_pre),]
dat_f_post<-dat_f_post[complete.cases(dat_f_post),]
dat_d_pre<-dat_d_pre[complete.cases(dat_d_pre),]
dat_d_post<-dat_d_post[complete.cases(dat_d_post),]

# bootstrap group means & order results
boot_f_pre<-dat_f_pre$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f_pre<-boot_f_pre$t %>% sort()
boot_f_post<-dat_f_post$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f_post<-boot_f_post$t %>% sort()
boot_d_pre<-dat_d_pre$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d_pre<-boot_d_pre$t %>% sort()
boot_d_post<-dat_d_post$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d_post<-boot_d_post$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f_pre[c(501:9500)], # choose only 95% CIs
                Developed = boot_d_pre[c(501:9500)], 
                Period = "Pre-typhoon") %>%  # pre-typhoon period
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_sim2<-tibble(Forest = boot_f_post[c(501:9500)], # choose only 95% CIs
                Developed = boot_d_post[c(501:9500)], 
                Period = "Post-typhoon") %>%  # post-typhoon period
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_sim<-dat_sim %>% add_row(dat_sim2); rm(dat_sim2)
dat_raw<-tibble(Forest = dat_f_pre$Stability,
                Developed = dat_d_pre$Stability, 
                Period = "Pre-typhoon") %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")
dat_raw2<-tibble(Forest = dat_f_post$Stability,
                Developed = dat_d_post$Stability, 
                Period = "Post-typhoon") %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")
dat_raw<-dat_raw %>% add_row(dat_raw2); rm(dat_raw2)

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_raw$Period<-dat_raw$Period %>% parse_character() %>% parse_factor(levels = c('Pre-typhoon','Post-typhoon'))
dat_sim$Period<-dat_sim$Period %>% parse_character() %>% parse_factor(levels = c('Pre-typhoon','Post-typhoon'))

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest',
         Period == 'Pre-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap),
            mid = median(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Forest',
         Period == 'Post-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap),
            mid = median(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed',
         Period == 'Pre-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap),
            mid = median(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed',
         Period == 'Post-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap),
            mid = median(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "Spatial Variability") + 
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Landuse,group = Period),
                     position = position_jitterdodge(0.6),
                     size = 2, alpha = 0.1,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Period),
                       alpha = 0.6) +
  scale_color_manual(values = c('#00B2EE','#EE6AA7'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Period),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#00B2EE','#EE6AA7'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_c<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_c
```

All groups differ. Effect size of pre vs post-typhoon is larger in developed than forest sites.

```{r}
(Panel_a | Panel_b | Panel_c)
rm(Panel_a,Panel_b,Panel_c)
```


## NDSI_Bio

# Baseline vs Landuse

```{r}
# subset dataframe
dat_f<-tidy.stability_AI %>%
  filter(Index %in% "NDSI_Bio" & Stability_dimension %in% 'Baseline' & kmeans %in% 'Forest') 
dat_d<-tidy.stability_AI %>%
  filter(Index %in% "NDSI_Bio" & Stability_dimension %in% 'Baseline' & kmeans %in% 'Developed')
dat_f<-dat_f[complete.cases(dat_f),]
dat_d<-dat_d[complete.cases(dat_d),]

# bootstrap group means & order results
boot_f<-dat_f$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f<-boot_f$t %>% sort()
boot_d<-dat_d$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d<-boot_d$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f[c(501:9500)], # choose only 95% CIs
                Developed = boot_d[c(501:9500)]) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_raw<-tibble(Developed = dat_d$Stability,Forest = c(dat_f$Stability,NA,NA,NA,NA)) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "Pre-typhoon baseline") + 
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Landuse),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Landuse),
                       alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_a<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_a
```

No difference.

# Post-typhoon vs Landuse

```{r}
# subset dataframe
dat_f<-tidy.stability_AI %>%
  filter(Index %in% "NDSI_Bio" & Stability_dimension %in% 'Mean_post' & kmeans %in% 'Forest') 
dat_d<-tidy.stability_AI %>%
  filter(Index %in% "NDSI_Bio" & Stability_dimension %in% 'Mean_post' & kmeans %in% 'Developed')
dat_f<-dat_f[complete.cases(dat_f),]
dat_d<-dat_d[complete.cases(dat_d),]

# bootstrap group means & order results
boot_f<-dat_f$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f<-boot_f$t %>% sort()
boot_d<-dat_d$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d<-boot_d$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f[c(501:9500)], # choose only 95% CIs
                Developed = boot_d[c(501:9500)]) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_raw<-tibble(Developed = dat_d$Stability,Forest = c(dat_f$Stability,NA,NA,NA,NA)) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "Post-typhoon index value") + 
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Landuse),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Landuse),
                       alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_b<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_b
```

No difference.

# Temporal Stability vs Landuse

```{r}
# subset dataframe
dat_f<-tidy.stability_AI %>%
  filter(Index %in% "NDSI_Bio" & Stability_dimension %in% 'Temp_Var' & kmeans %in% 'Forest') 
dat_d<-tidy.stability_AI %>%
  filter(Index %in% "NDSI_Bio" & Stability_dimension %in% 'Temp_Var' & kmeans %in% 'Developed')
dat_f<-dat_f[complete.cases(dat_f),]
dat_d<-dat_d[complete.cases(dat_d),]

# bootstrap group means & order results
boot_f<-dat_f$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f<-boot_f$t %>% sort()
boot_d<-dat_d$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d<-boot_d$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f[c(501:9500)], # choose only 95% CIs
                Developed = boot_d[c(501:9500)]) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_raw<-tibble(Developed = dat_d$Stability,Forest = c(dat_f$Stability,NA,NA,NA,NA)) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "1 - Temporal Variability") + 
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Landuse),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Landuse),
                       alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_c<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_c
```

No difference.

# Resistance vs Landuse

```{r}
# subset dataframe
dat_f<-tidy.stability_AI %>%
  filter(Index %in% "NDSI_Bio" & Stability_dimension %in% 'Resist' & kmeans %in% 'Forest') 
dat_d<-tidy.stability_AI %>%
  filter(Index %in% "NDSI_Bio" & Stability_dimension %in% 'Resist' & kmeans %in% 'Developed')
dat_f<-dat_f[complete.cases(dat_f),]
dat_d<-dat_d[complete.cases(dat_d),]

# bootstrap group means & order results
boot_f<-dat_f$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f<-boot_f$t %>% sort()
boot_d<-dat_d$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d<-boot_d$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f[c(501:9500)], # choose only 95% CIs
                Developed = boot_d[c(501:9500)]) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_raw<-tibble(Developed = dat_d$Stability,Forest = c(dat_f$Stability,NA,NA,NA,NA,NA)) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "Resistance") + 
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Landuse),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Landuse),
                       alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_d<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_d
```

No difference.

# Recovery vs Landuse

```{r}
# subset dataframe
dat_f<-tidy.stability_AI %>%
  filter(Index %in% "NDSI_Bio" & Stability_dimension %in% 'Recov_time' & kmeans %in% 'Forest') 
dat_d<-tidy.stability_AI %>%
  filter(Index %in% "NDSI_Bio" & Stability_dimension %in% 'Recov_time' & kmeans %in% 'Developed')
dat_f<-dat_f[complete.cases(dat_f),]
dat_d<-dat_d[complete.cases(dat_d),]

# bootstrap group means & order results
boot_f<-dat_f$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f<-boot_f$t %>% sort()
boot_d<-dat_d$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d<-boot_d$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f[c(501:9500)], # choose only 95% CIs
                Developed = boot_d[c(501:9500)]) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_raw<-tibble(Developed = dat_d$Stability,Forest = c(dat_f$Stability,NA,NA,NA,NA)) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "Recovery Speed") + 
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Landuse),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Landuse),
                       alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_e<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_e
```

Recovery speed slower in developed sites.

# Resilience vs Landuse

```{r}
# subset dataframe
dat_f<-tidy.stability_AI %>%
  filter(Index %in% "NDSI_Bio" & Stability_dimension %in% 'Resil' & kmeans %in% 'Forest') 
dat_d<-tidy.stability_AI %>%
  filter(Index %in% "NDSI_Bio" & Stability_dimension %in% 'Resil' & kmeans %in% 'Developed')
dat_f<-dat_f[complete.cases(dat_f),]
dat_d<-dat_d[complete.cases(dat_d),]

# bootstrap group means & order results
boot_f<-dat_f$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f<-boot_f$t %>% sort()
boot_d<-dat_d$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d<-boot_d$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f[c(501:9500)], # choose only 95% CIs
                Developed = boot_d[c(501:9500)]) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_raw<-tibble(Developed = dat_d$Stability,Forest = c(dat_f$Stability,NA,NA,NA,NA)) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "Resilience") + 
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Landuse),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Landuse),
                       alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_f<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_f
```

No difference.

# Extent of Change vs Landuse

```{r}
# subset dataframe
dat_f<-tidy.stability_AI %>%
  filter(Index %in% "NDSI_Bio" & Stability_dimension %in% 'Ext_Chng' & kmeans %in% 'Forest') 
dat_d<-tidy.stability_AI %>%
  filter(Index %in% "NDSI_Bio" & Stability_dimension %in% 'Ext_Chng' & kmeans %in% 'Developed')
dat_f<-dat_f[complete.cases(dat_f),]
dat_d<-dat_d[complete.cases(dat_d),]

# bootstrap group means & order results
boot_f<-dat_f$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f<-boot_f$t %>% sort()
boot_d<-dat_d$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d<-boot_d$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f[c(501:9500)], # choose only 95% CIs
                Developed = boot_d[c(501:9500)]) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_raw<-tibble(Developed = dat_d$Stability,Forest = c(dat_f$Stability,NA,NA,NA,NA)) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")
dat_sig<-tibble(Developed = dat_d$p_sig,Forest = c(dat_f$p_sig,NA,NA,NA,NA)) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Sig")
dat_raw<-dat_raw %>% add_column(Sig = dat_sig$Sig); rm(dat_sig)

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_raw$Sig<-dat_raw$Sig %>% as.character() %>% parse_factor(levels = c('0','1'),include_na = F)

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "Extent of Change") + 
  geom_hline(yintercept = 0,lty = 2,alpha=0.5) +
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Sig),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Landuse),
                       alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_shape_manual(values = c(2,8)) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_hline(yintercept = 0,lty = 2,alpha=0.5) +
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity", alpha=0.75) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_g<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_g
```

No difference.

# Multipanel figure

```{r}
(Panel_a | Panel_b) / (Panel_c | Panel_d) / (Panel_e | Panel_g) #/ (Panel_f | plot_spacer())
rm(Panel_a,Panel_b,Panel_c,Panel_d,Panel_e,Panel_f,Panel_g)
```

## Anthropophony (NDSI_Anthro)

# Spatial Variability vs time period

```{r}
# subset dataframe
dat_pre<-tidy.spatial_AI %>%
  filter(Index %in% "NDSI_Bio" & Stability_dimension %in% 'Spatial_Var' & Period %in% 'Pre-typhoon') 
dat_post<-tidy.spatial_AI %>%
  filter(Index %in% "NDSI_Bio" & Stability_dimension %in% 'Spatial_Var' & Period %in% 'Post-typhoon')
dat_pre<-dat_pre[complete.cases(dat_pre),]
dat_post<-dat_post[complete.cases(dat_post),]

# bootstrap group means & order results
boot_pre<-dat_pre$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_pre<-boot_pre$t %>% sort()
boot_post<-dat_post$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_post<-boot_post$t %>% sort()

# combine data
dat_sim<-tibble('Pre-typhoon' = boot_pre[c(501:9500)], # choose only 95% CIs
                'Post-typhoon' = boot_post[c(501:9500)]) %>%  
  pivot_longer(cols = c('Pre-typhoon','Post-typhoon'),names_to = "Period",values_to = "Bootstrap")
dat_raw<-tibble('Pre-typhoon' = dat_pre$Stability,
                'Post-typhoon' = dat_post$Stability) %>%  
  pivot_longer(cols = c('Pre-typhoon','Post-typhoon'),names_to = "Period",values_to = "Stability")

# convert to factor
dat_raw$Period<-dat_raw$Period %>% parse_character() %>% parse_factor(levels = c('Pre-typhoon','Post-typhoon'))
dat_sim$Period<-dat_sim$Period %>% parse_character() %>% parse_factor(levels = c('Pre-typhoon','Post-typhoon'))

# Analysis
dat_sim %>% 
  filter(Period == 'Pre-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Period == 'Post-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Typhoon Period",y = "Spatial Variability") + 
  geom_point(mapping = aes(x = Period, y=Stability,
                           shape = Period),
                     position = position_jitter(width = 0.35),
                     size = 2, alpha = 0.1,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Period, y=Stability,
                             fill = Period),
                       alpha = 0.6) +
  scale_color_manual(values = c('#00B2EE','#EE6AA7'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Period),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#00B2EE','#EE6AA7'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_a<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_pre,boot_post,dat_pre,dat_post,dat_raw,dat_sim)
Panel_a
```

Biophony spatial variability higher after typhoons.

# Spatial Variability vs land use

```{r}
# subset dataframe
dat_f<-tidy.spatial_AI %>%
  filter(Index %in% "NDSI_Bio" & Stability_dimension %in% 'Forest_Var' & Period %in% c('Pre-typhoon','Post-typhoon'))
dat_d<-tidy.spatial_AI %>%
  filter(Index %in% "NDSI_Bio" & Stability_dimension %in% 'Developed_Var' & Period %in% c('Pre-typhoon','Post-typhoon'))
dat_f<-dat_f[complete.cases(dat_f),]
dat_d<-dat_d[complete.cases(dat_d),]

# bootstrap group means & order results
boot_f<-dat_f$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f<-boot_f$t %>% sort()
boot_d<-dat_d$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d<-boot_d$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f[c(501:9500)], # choose only 95% CIs
                Developed = boot_d[c(501:9500)]) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_raw<-tibble(Forest = dat_f$Stability,
                Developed = dat_d$Stability) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "Spatial Variability") + 
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Landuse),
                     position = position_jitter(width = 0.35),
                     size = 2, alpha = 0.1,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Landuse),
                       alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_b<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_b
```

Biophony spatial variability higher among developed sites.

# Spatial Variability vs Time period x Landuse

```{r}
# subset dataframe
dat_f_pre<-tidy.spatial_AI %>%
  filter(Index %in% "NDSI_Bio" & Stability_dimension %in% 'Forest_Var' & Period %in% c('Pre-typhoon'))
dat_f_post<-tidy.spatial_AI %>%
  filter(Index %in% "NDSI_Bio" & Stability_dimension %in% 'Forest_Var' & Period %in% c('Post-typhoon'))
dat_d_pre<-tidy.spatial_AI %>%
  filter(Index %in% "NDSI_Bio" & Stability_dimension %in% 'Developed_Var' & Period %in% c('Pre-typhoon'))
dat_d_post<-tidy.spatial_AI %>%
  filter(Index %in% "NDSI_Bio" & Stability_dimension %in% 'Developed_Var' & Period %in% c('Post-typhoon'))
dat_f_pre<-dat_f_pre[complete.cases(dat_f_pre),]
dat_f_post<-dat_f_post[complete.cases(dat_f_post),]
dat_d_pre<-dat_d_pre[complete.cases(dat_d_pre),]
dat_d_post<-dat_d_post[complete.cases(dat_d_post),]

# bootstrap group means & order results
boot_f_pre<-dat_f_pre$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f_pre<-boot_f_pre$t %>% sort()
boot_f_post<-dat_f_post$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f_post<-boot_f_post$t %>% sort()
boot_d_pre<-dat_d_pre$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d_pre<-boot_d_pre$t %>% sort()
boot_d_post<-dat_d_post$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d_post<-boot_d_post$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f_pre[c(501:9500)], # choose only 95% CIs
                Developed = boot_d_pre[c(501:9500)], 
                Period = "Pre-typhoon") %>%  # pre-typhoon period
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_sim2<-tibble(Forest = boot_f_post[c(501:9500)], # choose only 95% CIs
                Developed = boot_d_post[c(501:9500)], 
                Period = "Post-typhoon") %>%  # post-typhoon period
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_sim<-dat_sim %>% add_row(dat_sim2); rm(dat_sim2)
dat_raw<-tibble(Forest = dat_f_pre$Stability,
                Developed = dat_d_pre$Stability, 
                Period = "Pre-typhoon") %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")
dat_raw2<-tibble(Forest = dat_f_post$Stability,
                Developed = dat_d_post$Stability, 
                Period = "Post-typhoon") %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")
dat_raw<-dat_raw %>% add_row(dat_raw2); rm(dat_raw2)

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_raw$Period<-dat_raw$Period %>% parse_character() %>% parse_factor(levels = c('Pre-typhoon','Post-typhoon'))
dat_sim$Period<-dat_sim$Period %>% parse_character() %>% parse_factor(levels = c('Pre-typhoon','Post-typhoon'))

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest',
         Period == 'Pre-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap),
            mid = median(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Forest',
         Period == 'Post-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap),
            mid = median(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed',
         Period == 'Pre-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap),
            mid = median(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed',
         Period == 'Post-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap),
            mid = median(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "Spatial Variability") + 
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Landuse,group = Period),
                     position = position_jitterdodge(0.6),
                     size = 2, alpha = 0.1,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Period),
                       alpha = 0.6) +
  scale_color_manual(values = c('#00B2EE','#EE6AA7'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Period),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#00B2EE','#EE6AA7'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_c<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_c
```

All groups differ. Effect size of pre vs post-typhoon is pretty much equal in forest vs developed sites.

```{r}
(Panel_a | Panel_b | Panel_c)
rm(Panel_a,Panel_b,Panel_c)
```

## NDSI_Anthro 

# Baseline vs Landuse

```{r}
# subset dataframe
dat_f<-tidy.stability_AI %>%
  filter(Index %in% "NDSI_Anth" & Stability_dimension %in% 'Baseline' & kmeans %in% 'Forest') 
dat_d<-tidy.stability_AI %>%
  filter(Index %in% "NDSI_Anth" & Stability_dimension %in% 'Baseline' & kmeans %in% 'Developed')
dat_f<-dat_f[complete.cases(dat_f),]
dat_d<-dat_d[complete.cases(dat_d),]

# bootstrap group means & order results
boot_f<-dat_f$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f<-boot_f$t %>% sort()
boot_d<-dat_d$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d<-boot_d$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f[c(501:9500)], # choose only 95% CIs
                Developed = boot_d[c(501:9500)]) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_raw<-tibble(Developed = dat_d$Stability,Forest = c(dat_f$Stability,NA,NA,NA,NA)) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "Pre-typhoon baseline") + 
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Landuse),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Landuse),
                       alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_a<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_a
```

No difference.

# Post-typhoon vs Landuse

```{r}
# subset dataframe
dat_f<-tidy.stability_AI %>%
  filter(Index %in% "NDSI_Anth" & Stability_dimension %in% 'Mean_post' & kmeans %in% 'Forest') 
dat_d<-tidy.stability_AI %>%
  filter(Index %in% "NDSI_Anth" & Stability_dimension %in% 'Mean_post' & kmeans %in% 'Developed')
dat_f<-dat_f[complete.cases(dat_f),]
dat_d<-dat_d[complete.cases(dat_d),]

# bootstrap group means & order results
boot_f<-dat_f$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f<-boot_f$t %>% sort()
boot_d<-dat_d$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d<-boot_d$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f[c(501:9500)], # choose only 95% CIs
                Developed = boot_d[c(501:9500)]) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_raw<-tibble(Developed = dat_d$Stability,Forest = c(dat_f$Stability,NA,NA,NA,NA)) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "Post-typhoon index value") + 
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Landuse),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Landuse),
                       alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_b<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_b
```

No difference.

# Temporal Stability vs Landuse

```{r}
# subset dataframe
dat_f<-tidy.stability_AI %>%
  filter(Index %in% "NDSI_Anth" & Stability_dimension %in% 'Temp_Var' & kmeans %in% 'Forest') 
dat_d<-tidy.stability_AI %>%
  filter(Index %in% "NDSI_Anth" & Stability_dimension %in% 'Temp_Var' & kmeans %in% 'Developed')
dat_f<-dat_f[complete.cases(dat_f),]
dat_d<-dat_d[complete.cases(dat_d),]

# bootstrap group means & order results
boot_f<-dat_f$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f<-boot_f$t %>% sort()
boot_d<-dat_d$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d<-boot_d$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f[c(501:9500)], # choose only 95% CIs
                Developed = boot_d[c(501:9500)]) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_raw<-tibble(Developed = dat_d$Stability,Forest = c(dat_f$Stability,NA,NA,NA,NA)) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "1 - Temporal Variability") + 
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Landuse),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Landuse),
                       alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_c<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_c
```

No difference.

# Resistance vs Landuse

```{r}
# subset dataframe
dat_f<-tidy.stability_AI %>%
  filter(Index %in% "NDSI_Anth" & Stability_dimension %in% 'Resist' & kmeans %in% 'Forest') 
dat_d<-tidy.stability_AI %>%
  filter(Index %in% "NDSI_Anth" & Stability_dimension %in% 'Resist' & kmeans %in% 'Developed')
dat_f<-dat_f[complete.cases(dat_f),]
dat_d<-dat_d[complete.cases(dat_d),]

# bootstrap group means & order results
boot_f<-dat_f$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f<-boot_f$t %>% sort()
boot_d<-dat_d$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d<-boot_d$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f[c(501:9500)], # choose only 95% CIs
                Developed = boot_d[c(501:9500)]) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_raw<-tibble(Developed = dat_d$Stability,Forest = c(dat_f$Stability,NA,NA,NA,NA,NA)) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "Resistance") + 
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Landuse),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Landuse),
                       alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_d<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_d
```

No difference.

# Recovery vs Landuse

```{r}
# subset dataframe
dat_f<-tidy.stability_AI %>%
  filter(Index %in% "NDSI_Anth" & Stability_dimension %in% 'Recov_time' & kmeans %in% 'Forest') 
dat_d<-tidy.stability_AI %>%
  filter(Index %in% "NDSI_Anth" & Stability_dimension %in% 'Recov_time' & kmeans %in% 'Developed')
dat_f<-dat_f[complete.cases(dat_f),]
dat_d<-dat_d[complete.cases(dat_d),]

# bootstrap group means & order results
boot_f<-dat_f$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f<-boot_f$t %>% sort()
boot_d<-dat_d$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d<-boot_d$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f[c(501:9500)], # choose only 95% CIs
                Developed = boot_d[c(501:9500)]) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_raw<-tibble(Developed = dat_d$Stability,Forest = c(dat_f$Stability,NA,NA,NA,NA,NA)) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "Recovery Speed") + 
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Landuse),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Landuse),
                       alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_e<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_e
```

Developed sites recover slower.

# Resilience vs Landuse

```{r}
# subset dataframe
dat_f<-tidy.stability_AI %>%
  filter(Index %in% "NDSI_Anth" & Stability_dimension %in% 'Resil' & kmeans %in% 'Forest') 
dat_d<-tidy.stability_AI %>%
  filter(Index %in% "NDSI_Anth" & Stability_dimension %in% 'Resil' & kmeans %in% 'Developed')
dat_f<-dat_f[complete.cases(dat_f),]
dat_d<-dat_d[complete.cases(dat_d),]

# bootstrap group means & order results
boot_f<-dat_f$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f<-boot_f$t %>% sort()
boot_d<-dat_d$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d<-boot_d$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f[c(501:9500)], # choose only 95% CIs
                Developed = boot_d[c(501:9500)]) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_raw<-tibble(Developed = dat_d$Stability,Forest = c(dat_f$Stability,NA,NA,NA,NA,NA)) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "Resilience") + 
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Landuse),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Landuse),
                       alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_f<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_f
```

Developed sites more resilient.

# Extent of Change vs Landuse

```{r}
# subset dataframe
dat_f<-tidy.stability_AI %>%
  filter(Index %in% "NDSI_Anth" & Stability_dimension %in% 'Ext_Chng' & kmeans %in% 'Forest') 
dat_d<-tidy.stability_AI %>%
  filter(Index %in% "NDSI_Anth" & Stability_dimension %in% 'Ext_Chng' & kmeans %in% 'Developed')
dat_f<-dat_f[complete.cases(dat_f),]
dat_d<-dat_d[complete.cases(dat_d),]

# bootstrap group means & order results
boot_f<-dat_f$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f<-boot_f$t %>% sort()
boot_d<-dat_d$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d<-boot_d$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f[c(501:9500)], # choose only 95% CIs
                Developed = boot_d[c(501:9500)]) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_raw<-tibble(Developed = dat_d$Stability,Forest = c(dat_f$Stability,NA,NA,NA,NA)) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")
dat_sig<-tibble(Developed = dat_d$p_sig,Forest = c(dat_f$p_sig,NA,NA,NA,NA)) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Sig")
dat_raw<-dat_raw %>% add_column(Sig = dat_sig$Sig); rm(dat_sig)

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_raw$Sig<-dat_raw$Sig %>% as.character() %>% parse_factor(levels = c('0','1'),include_na = F)

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "Extent of Change") + 
  geom_hline(yintercept = 0,lty = 2,alpha=0.5) +
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Sig),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Landuse),
                       alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_shape_manual(values = c(2,8)) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_hline(yintercept = 0,lty = 2,alpha=0.5) +
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity", alpha=0.75) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_g<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_g
```

No difference.

# Multipanel figure

```{r}
(Panel_a | Panel_b) / (Panel_c | Panel_d) / (Panel_e | Panel_g) #/ (Panel_f | plot_spacer())
rm(Panel_a,Panel_b,Panel_c,Panel_d,Panel_e,Panel_f,Panel_g)
```

## Spatial variability

# Spatial Variability vs time period

```{r}
# subset dataframe
dat_pre<-tidy.spatial_AI %>%
  filter(Index %in% "NDSI_Anth" & Stability_dimension %in% 'Spatial_Var' & Period %in% 'Pre-typhoon') 
dat_post<-tidy.spatial_AI %>%
  filter(Index %in% "NDSI_Anth" & Stability_dimension %in% 'Spatial_Var' & Period %in% 'Post-typhoon')
dat_pre<-dat_pre[complete.cases(dat_pre),]
dat_post<-dat_post[complete.cases(dat_post),]

# bootstrap group means & order results
boot_pre<-dat_pre$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_pre<-boot_pre$t %>% sort()
boot_post<-dat_post$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_post<-boot_post$t %>% sort()

# combine data
dat_sim<-tibble('Pre-typhoon' = boot_pre[c(501:9500)], # choose only 95% CIs
                'Post-typhoon' = boot_post[c(501:9500)]) %>%  
  pivot_longer(cols = c('Pre-typhoon','Post-typhoon'),names_to = "Period",values_to = "Bootstrap")
dat_raw<-tibble('Pre-typhoon' = dat_pre$Stability,
                'Post-typhoon' = dat_post$Stability) %>%  
  pivot_longer(cols = c('Pre-typhoon','Post-typhoon'),names_to = "Period",values_to = "Stability")

# convert to factor
dat_raw$Period<-dat_raw$Period %>% parse_character() %>% parse_factor(levels = c('Pre-typhoon','Post-typhoon'))
dat_sim$Period<-dat_sim$Period %>% parse_character() %>% parse_factor(levels = c('Pre-typhoon','Post-typhoon'))

# Analysis
dat_sim %>% 
  filter(Period == 'Pre-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Period == 'Post-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Typhoon Period",y = "Spatial Variability") + 
  geom_point(mapping = aes(x = Period, y=Stability,
                           shape = Period),
                     position = position_jitter(width = 0.35),
                     size = 2, alpha = 0.1,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Period, y=Stability,
                             fill = Period),
                       alpha = 0.6) +
  scale_color_manual(values = c('#00B2EE','#EE6AA7'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Period),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#00B2EE','#EE6AA7'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_a<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_pre,boot_post,dat_pre,dat_post,dat_raw,dat_sim)
Panel_a
```

Anthropophony spatial variability lower after typhoons.

# Spatial Variability vs land use

```{r}
# subset dataframe
dat_f<-tidy.spatial_AI %>%
  filter(Index %in% "NDSI_Anth" & Stability_dimension %in% 'Forest_Var' & Period %in% c('Pre-typhoon','Post-typhoon'))
dat_d<-tidy.spatial_AI %>%
  filter(Index %in% "NDSI_Anth" & Stability_dimension %in% 'Developed_Var' & Period %in% c('Pre-typhoon','Post-typhoon'))
dat_f<-dat_f[complete.cases(dat_f),]
dat_d<-dat_d[complete.cases(dat_d),]

# bootstrap group means & order results
boot_f<-dat_f$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f<-boot_f$t %>% sort()
boot_d<-dat_d$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d<-boot_d$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f[c(501:9500)], # choose only 95% CIs
                Developed = boot_d[c(501:9500)]) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_raw<-tibble(Forest = dat_f$Stability,
                Developed = dat_d$Stability) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "Spatial Variability") + 
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Landuse),
                     position = position_jitter(width = 0.35),
                     size = 2, alpha = 0.1,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Landuse),
                       alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_b<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_b
```

Anthropophony spatial variability higher among developed sites (likely because developed includes a mix of urban and agriculture).

# Spatial Variability vs Time period x Landuse

```{r}
# subset dataframe
dat_f_pre<-tidy.spatial_AI %>%
  filter(Index %in% "NDSI_Anth" & Stability_dimension %in% 'Forest_Var' & Period %in% c('Pre-typhoon'))
dat_f_post<-tidy.spatial_AI %>%
  filter(Index %in% "NDSI_Anth" & Stability_dimension %in% 'Forest_Var' & Period %in% c('Post-typhoon'))
dat_d_pre<-tidy.spatial_AI %>%
  filter(Index %in% "NDSI_Anth" & Stability_dimension %in% 'Developed_Var' & Period %in% c('Pre-typhoon'))
dat_d_post<-tidy.spatial_AI %>%
  filter(Index %in% "NDSI_Anth" & Stability_dimension %in% 'Developed_Var' & Period %in% c('Post-typhoon'))
dat_f_pre<-dat_f_pre[complete.cases(dat_f_pre),]
dat_f_post<-dat_f_post[complete.cases(dat_f_post),]
dat_d_pre<-dat_d_pre[complete.cases(dat_d_pre),]
dat_d_post<-dat_d_post[complete.cases(dat_d_post),]

# bootstrap group means & order results
boot_f_pre<-dat_f_pre$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f_pre<-boot_f_pre$t %>% sort()
boot_f_post<-dat_f_post$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f_post<-boot_f_post$t %>% sort()
boot_d_pre<-dat_d_pre$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d_pre<-boot_d_pre$t %>% sort()
boot_d_post<-dat_d_post$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d_post<-boot_d_post$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f_pre[c(501:9500)], # choose only 95% CIs
                Developed = boot_d_pre[c(501:9500)], 
                Period = "Pre-typhoon") %>%  # pre-typhoon period
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_sim2<-tibble(Forest = boot_f_post[c(501:9500)], # choose only 95% CIs
                Developed = boot_d_post[c(501:9500)], 
                Period = "Post-typhoon") %>%  # post-typhoon period
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_sim<-dat_sim %>% add_row(dat_sim2); rm(dat_sim2)
dat_raw<-tibble(Forest = dat_f_pre$Stability,
                Developed = dat_d_pre$Stability, 
                Period = "Pre-typhoon") %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")
dat_raw2<-tibble(Forest = dat_f_post$Stability,
                Developed = dat_d_post$Stability, 
                Period = "Post-typhoon") %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")
dat_raw<-dat_raw %>% add_row(dat_raw2); rm(dat_raw2)

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_raw$Period<-dat_raw$Period %>% parse_character() %>% parse_factor(levels = c('Pre-typhoon','Post-typhoon'))
dat_sim$Period<-dat_sim$Period %>% parse_character() %>% parse_factor(levels = c('Pre-typhoon','Post-typhoon'))

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest',
         Period == 'Pre-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap),
            mid = median(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Forest',
         Period == 'Post-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap),
            mid = median(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed',
         Period == 'Pre-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap),
            mid = median(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed',
         Period == 'Post-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap),
            mid = median(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "Spatial Variability") + 
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Landuse,group = Period),
                     position = position_jitterdodge(0.6),
                     size = 2, alpha = 0.1,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Period),
                       alpha = 0.6) +
  scale_color_manual(values = c('#00B2EE','#EE6AA7'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Period),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#00B2EE','#EE6AA7'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_c<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_c
```

All groups differ. Effect size of pre vs post-typhoon is higher in forest (further decline of variability following typhoon)

```{r}
(Panel_a | Panel_b | Panel_c)
rm(Panel_a,Panel_b,Panel_c)
```

### Species detections

## Time period

```{r}
# subset dataframe
dat_pre<-tidy.stability_bird %>%
  filter(Cutoff %in% 0.5 & Stability_dimension %in% 'Baseline') 
dat_post<-tidy.stability_bird %>%
  filter(Cutoff %in% 0.5 & Stability_dimension %in% 'Mean_post') 
dat_pre<-dat_pre[complete.cases(dat_pre),]
dat_post<-dat_post[complete.cases(dat_post),]

# bootstrap group means & order results
boot_pre<-dat_pre$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_pre<-boot_pre$t %>% sort()
boot_post<-dat_post$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_post<-boot_post$t %>% sort()

# combine data
dat_sim<-tibble('Pre-typhoon' = boot_pre[c(501:9500)], # choose only 95% CIs
                'Post-typhoon' = boot_post[c(501:9500)]) %>%  
  pivot_longer(cols = c('Pre-typhoon','Post-typhoon'),names_to = "Period",values_to = "Bootstrap")
dat_raw<-tibble('Pre-typhoon' = dat_pre$Stability,'Post-typhoon' = dat_post$Stability) %>%  
  pivot_longer(cols = c('Pre-typhoon','Post-typhoon'),names_to = "Period",values_to = "Stability")

# convert to factor
dat_raw$Period<-dat_raw$Period %>% parse_character() %>% parse_factor(levels = c('Pre-typhoon','Post-typhoon'))
dat_sim$Period<-dat_sim$Period %>% parse_character() %>% parse_factor(levels = c('Pre-typhoon','Post-typhoon'))

# Analysis
dat_sim %>% 
  filter(Period == 'Pre-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Period == 'Post-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Period",y = "Total species detections") + 
  geom_point(mapping = aes(x = Period, y=Stability,
                           shape = Period),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Period, y=Stability,
                             fill = Period),
                       alpha = 0.6) +
  scale_color_manual(values = c('#00B2EE','#EE6AA7'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Period),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#00B2EE','#EE6AA7'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_a<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_a
```

No effect on combined species.

```{r}
# subset dataframe
dat_pre<-tidy.stability_bird %>%
  filter(Species_ID %in% "Corvus_macrorhynchos" & Cutoff %in% 0.5 & Stability_dimension %in% 'Baseline') 
dat_post<-tidy.stability_bird %>%
  filter(Species_ID %in% "Corvus_macrorhynchos" & Cutoff %in% 0.5 & Stability_dimension %in% 'Mean_post') 
dat_pre<-dat_pre[complete.cases(dat_pre),]
dat_post<-dat_post[complete.cases(dat_post),]

# bootstrap group means & order results
boot_pre<-dat_pre$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_pre<-boot_pre$t %>% sort()
boot_post<-dat_post$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_post<-boot_post$t %>% sort()

# combine data
dat_sim<-tibble('Pre-typhoon' = boot_pre[c(501:9500)], # choose only 95% CIs
                'Post-typhoon' = boot_post[c(501:9500)]) %>%  
  pivot_longer(cols = c('Pre-typhoon','Post-typhoon'),names_to = "Period",values_to = "Bootstrap")
dat_raw<-tibble('Pre-typhoon' = dat_pre$Stability,'Post-typhoon' = dat_post$Stability) %>%  
  pivot_longer(cols = c('Pre-typhoon','Post-typhoon'),names_to = "Period",values_to = "Stability")

# convert to factor
dat_raw$Period<-dat_raw$Period %>% parse_character() %>% parse_factor(levels = c('Pre-typhoon','Post-typhoon'))
dat_sim$Period<-dat_sim$Period %>% parse_character() %>% parse_factor(levels = c('Pre-typhoon','Post-typhoon'))

# Analysis
dat_sim %>% 
  filter(Period == 'Pre-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Period == 'Post-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Period",y = "C. macrorhynchos detections") + 
  geom_point(mapping = aes(x = Period, y=Stability,
                           shape = Period),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Period, y=Stability,
                             fill = Period),
                       alpha = 0.6) +
  scale_color_manual(values = c('#00B2EE','#EE6AA7'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Period),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#00B2EE','#EE6AA7'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_b<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_b
```

No effect on Corvus.

```{r}
# subset dataframe
dat_pre<-tidy.stability_bird %>%
  filter(Species_ID %in% "Horornis_diphone" & Cutoff %in% 0.5 & Stability_dimension %in% 'Baseline') 
dat_post<-tidy.stability_bird %>%
  filter(Species_ID %in% "Horornis_diphone" & Cutoff %in% 0.5 & Stability_dimension %in% 'Mean_post') 
dat_pre<-dat_pre[complete.cases(dat_pre),]
dat_post<-dat_post[complete.cases(dat_post),]

# bootstrap group means & order results
boot_pre<-dat_pre$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_pre<-boot_pre$t %>% sort()
boot_post<-dat_post$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_post<-boot_post$t %>% sort()

# combine data
dat_sim<-tibble('Pre-typhoon' = boot_pre[c(501:9500)], # choose only 95% CIs
                'Post-typhoon' = boot_post[c(501:9500)]) %>%  
  pivot_longer(cols = c('Pre-typhoon','Post-typhoon'),names_to = "Period",values_to = "Bootstrap")
dat_raw<-tibble('Pre-typhoon' = dat_pre$Stability,'Post-typhoon' = dat_post$Stability) %>%  
  pivot_longer(cols = c('Pre-typhoon','Post-typhoon'),names_to = "Period",values_to = "Stability")

# convert to factor
dat_raw$Period<-dat_raw$Period %>% parse_character() %>% parse_factor(levels = c('Pre-typhoon','Post-typhoon'))
dat_sim$Period<-dat_sim$Period %>% parse_character() %>% parse_factor(levels = c('Pre-typhoon','Post-typhoon'))

# Analysis
dat_sim %>% 
  filter(Period == 'Pre-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Period == 'Post-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Period",y = "H. diphone detections") + 
  geom_point(mapping = aes(x = Period, y=Stability,
                           shape = Period),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Period, y=Stability,
                             fill = Period),
                       alpha = 0.6) +
  scale_color_manual(values = c('#00B2EE','#EE6AA7'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Period),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#00B2EE','#EE6AA7'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_c<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
#rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_c
```

H. diphone decreases across sites.

```{r}
# subset dataframe
dat_pre<-tidy.stability_bird %>%
  filter(Species_ID %in% "Otus_elegans" & Cutoff %in% 0.5 & Stability_dimension %in% 'Baseline') 
dat_post<-tidy.stability_bird %>%
  filter(Species_ID %in% "Otus_elegans" & Cutoff %in% 0.5 & Stability_dimension %in% 'Mean_post') 
dat_pre<-dat_pre[complete.cases(dat_pre),]
dat_post<-dat_post[complete.cases(dat_post),]

# bootstrap group means & order results
boot_pre<-dat_pre$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_pre<-boot_pre$t %>% sort()
boot_post<-dat_post$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_post<-boot_post$t %>% sort()

# combine data
dat_sim<-tibble('Pre-typhoon' = boot_pre[c(501:9500)], # choose only 95% CIs
                'Post-typhoon' = boot_post[c(501:9500)]) %>%  
  pivot_longer(cols = c('Pre-typhoon','Post-typhoon'),names_to = "Period",values_to = "Bootstrap")
dat_raw<-tibble('Pre-typhoon' = dat_pre$Stability,'Post-typhoon' = dat_post$Stability) %>%  
  pivot_longer(cols = c('Pre-typhoon','Post-typhoon'),names_to = "Period",values_to = "Stability")

# convert to factor
dat_raw$Period<-dat_raw$Period %>% parse_character() %>% parse_factor(levels = c('Pre-typhoon','Post-typhoon'))
dat_sim$Period<-dat_sim$Period %>% parse_character() %>% parse_factor(levels = c('Pre-typhoon','Post-typhoon'))

# Analysis
dat_sim %>% 
  filter(Period == 'Pre-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Period == 'Post-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Period",y = "O. elegans detections") + 
  geom_point(mapping = aes(x = Period, y=Stability,
                           shape = Period),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Period, y=Stability,
                             fill = Period),
                       alpha = 0.6) +
  scale_color_manual(values = c('#00B2EE','#EE6AA7'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Period),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#00B2EE','#EE6AA7'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_d<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_pre,boot_post,dat_pre,dat_post,dat_raw,dat_sim)
Panel_d
```

No effect on Otus.

```{r}
(Panel_a | Panel_b) / (Panel_c | Panel_d)
rm(Panel_a,Panel_b,Panel_c)
```



## Corvus macrorhynchos
# Baseline vs Landuse

```{r}
# subset dataframe
dat_f<-tidy.stability_bird %>%
  filter(Species_ID %in% "Corvus_macrorhynchos" & Cutoff %in% 0.5 & Stability_dimension %in% 'Baseline' & kmeans %in% 'Forest') 
dat_d<-tidy.stability_bird %>%
  filter(Species_ID %in% "Corvus_macrorhynchos" & Cutoff %in% 0.5 & Stability_dimension %in% 'Baseline' & kmeans %in% 'Developed')
dat_f<-dat_f[complete.cases(dat_f),]
dat_d<-dat_d[complete.cases(dat_d),]

# bootstrap group means & order results
boot_f<-dat_f$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f<-boot_f$t %>% sort()
boot_d<-dat_d$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d<-boot_d$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f[c(501:9500)], # choose only 95% CIs
                Developed = boot_d[c(501:9500)]) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_raw<-tibble(Developed = dat_d$Stability,Forest = c(dat_f$Stability,NA)) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "Pre-typhoon baseline") + 
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Landuse),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Landuse),
                       alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_a<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_a
```

No difference.

# Post-typhoon vs Landuse

```{r}
# subset dataframe
dat_f<-tidy.stability_bird %>%
  filter(Species_ID %in% "Corvus_macrorhynchos" & Cutoff %in% 0.5 & Stability_dimension %in% 'Mean_post' & kmeans %in% 'Forest') 
dat_d<-tidy.stability_bird %>%
  filter(Species_ID %in% "Corvus_macrorhynchos" & Cutoff %in% 0.5 & Stability_dimension %in% 'Mean_post' & kmeans %in% 'Developed')
dat_f<-dat_f[complete.cases(dat_f),]
dat_d<-dat_d[complete.cases(dat_d),]

# bootstrap group means & order results
boot_f<-dat_f$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f<-boot_f$t %>% sort()
boot_d<-dat_d$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d<-boot_d$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f[c(501:9500)], # choose only 95% CIs
                Developed = boot_d[c(501:9500)]) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_raw<-tibble(Developed = dat_d$Stability,Forest = c(dat_f$Stability,NA)) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "Post-typhoon index value") + 
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Landuse),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Landuse),
                       alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_b<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_b
```

No difference.

# Temporal Stability vs Landuse

```{r}
# subset dataframe
dat_f<-tidy.stability_bird %>%
  filter(Species_ID %in% "Corvus_macrorhynchos" & Cutoff %in% 0.5 & Stability_dimension %in% 'Temp_Var' & kmeans %in% 'Forest') 
dat_d<-tidy.stability_bird %>%
  filter(Species_ID %in% "Corvus_macrorhynchos" & Cutoff %in% 0.5 & Stability_dimension %in% 'Temp_Var' & kmeans %in% 'Developed')
dat_f<-dat_f[complete.cases(dat_f),]
dat_d<-dat_d[complete.cases(dat_d),]

# bootstrap group means & order results
boot_f<-dat_f$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f<-boot_f$t %>% sort()
boot_d<-dat_d$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d<-boot_d$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f[c(501:9500)], # choose only 95% CIs
                Developed = boot_d[c(501:9500)]) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_raw<-tibble(Developed = dat_d$Stability,Forest = c(dat_f$Stability,NA)) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "1 - Temporal Variability") + 
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Landuse),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Landuse),
                       alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_c<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_c
```

No difference.

# Extent of Change vs Landuse

```{r}
# subset dataframe
dat_f<-tidy.stability_bird %>%
  filter(Species_ID %in% "Corvus_macrorhynchos" & Cutoff %in% 0.5 & Stability_dimension %in% 'Ext_Chng' & kmeans %in% 'Forest') 
dat_d<-tidy.stability_bird %>%
  filter(Species_ID %in% "Corvus_macrorhynchos" & Cutoff %in% 0.5 & Stability_dimension %in% 'Ext_Chng' & kmeans %in% 'Developed')
dat_f<-dat_f[complete.cases(dat_f),]
dat_d<-dat_d[complete.cases(dat_d),]

# bootstrap group means & order results
boot_f<-dat_f$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f<-boot_f$t %>% sort()
boot_d<-dat_d$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d<-boot_d$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f[c(501:9500)], # choose only 95% CIs
                Developed = boot_d[c(501:9500)]) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_raw<-tibble(Developed = dat_d$Stability,Forest = c(dat_f$Stability,NA)) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")
dat_sig<-tibble(Developed = dat_d$p_sig,Forest = c(dat_f$p_sig,NA)) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Sig")
dat_raw<-dat_raw %>% add_column(Sig = dat_sig$Sig); rm(dat_sig)

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_raw$Sig<-dat_raw$Sig %>% as.character() %>% parse_factor(levels = c('0','1'),include_na = F)

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "Extent of Change") + 
  geom_hline(yintercept = 0,lty = 2,alpha=0.5) +
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Sig),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Landuse),
                       alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_shape_manual(values = c(2,8)) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_hline(yintercept = 0,lty = 2,alpha=0.5) +
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity", alpha=0.75) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_d<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_d
```

No difference.

# Multipanel figure

```{r}
(Panel_a | Panel_b) / (Panel_c | Panel_d)
rm(Panel_a,Panel_b,Panel_c,Panel_d)
```

## Horornis diphone

# Baseline vs Landuse

```{r}
# subset dataframe
dat_f<-tidy.stability_bird %>%
  filter(Species_ID %in% "Horornis_diphone" & Cutoff %in% 0.5 & Stability_dimension %in% 'Baseline' & kmeans %in% 'Forest') 
dat_d<-tidy.stability_bird %>%
  filter(Species_ID %in% "Horornis_diphone" & Cutoff %in% 0.5 & Stability_dimension %in% 'Baseline' & kmeans %in% 'Developed')
dat_f<-dat_f[complete.cases(dat_f),]
dat_d<-dat_d[complete.cases(dat_d),]

# bootstrap group means & order results
boot_f<-dat_f$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f<-boot_f$t %>% sort()
boot_d<-dat_d$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d<-boot_d$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f[c(501:9500)], # choose only 95% CIs
                Developed = boot_d[c(501:9500)]) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_raw<-tibble(Developed = c(dat_d$Stability,NA),Forest = dat_f$Stability) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "Pre-typhoon baseline") + 
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Landuse),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Landuse),
                       alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_a<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_a
```

No difference.

# Post-typhoon vs Landuse

```{r}
# subset dataframe
dat_f<-tidy.stability_bird %>%
  filter(Species_ID %in% "Horornis_diphone" & Cutoff %in% 0.5 & Stability_dimension %in% 'Mean_post' & kmeans %in% 'Forest') 
dat_d<-tidy.stability_bird %>%
  filter(Species_ID %in% "Horornis_diphone" & Cutoff %in% 0.5 & Stability_dimension %in% 'Mean_post' & kmeans %in% 'Developed')
dat_f<-dat_f[complete.cases(dat_f),]
dat_d<-dat_d[complete.cases(dat_d),]

# bootstrap group means & order results
boot_f<-dat_f$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f<-boot_f$t %>% sort()
boot_d<-dat_d$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d<-boot_d$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f[c(501:9500)], # choose only 95% CIs
                Developed = boot_d[c(501:9500)]) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_raw<-tibble(Developed = c(dat_d$Stability,NA),Forest = dat_f$Stability) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "Post-typhoon index value") + 
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Landuse),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Landuse),
                       alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_b<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_b
```

No difference.

# Temporal Stability vs Landuse

```{r}
# subset dataframe
dat_f<-tidy.stability_bird %>%
  filter(Species_ID %in% "Horornis_diphone" & Cutoff %in% 0.5 & Stability_dimension %in% 'Temp_Var' & kmeans %in% 'Forest') 
dat_d<-tidy.stability_bird %>%
  filter(Species_ID %in% "Horornis_diphone" & Cutoff %in% 0.5 & Stability_dimension %in% 'Temp_Var' & kmeans %in% 'Developed')
dat_f<-dat_f[complete.cases(dat_f),]
dat_d<-dat_d[complete.cases(dat_d),]

# bootstrap group means & order results
boot_f<-dat_f$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f<-boot_f$t %>% sort()
boot_d<-dat_d$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d<-boot_d$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f[c(501:9500)], # choose only 95% CIs
                Developed = boot_d[c(501:9500)]) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_raw<-tibble(Developed = c(dat_d$Stability,NA),Forest = dat_f$Stability) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "1 - Temporal Variability") + 
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Landuse),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Landuse),
                       alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_c<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_c
```

No difference.

# Extent of Change vs Landuse

```{r}
# subset dataframe
dat_f<-tidy.stability_bird %>%
  filter(Species_ID %in% "Horornis_diphone" & Cutoff %in% 0.5 & Stability_dimension %in% 'Ext_Chng' & kmeans %in% 'Forest') 
dat_d<-tidy.stability_bird %>%
  filter(Species_ID %in% "Horornis_diphone" & Cutoff %in% 0.5 & Stability_dimension %in% 'Ext_Chng' & kmeans %in% 'Developed')
dat_f<-dat_f[complete.cases(dat_f),]
dat_d<-dat_d[complete.cases(dat_d),]

# bootstrap group means & order results
boot_f<-dat_f$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f<-boot_f$t %>% sort()
boot_d<-dat_d$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d<-boot_d$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f[c(501:9500)], # choose only 95% CIs
                Developed = boot_d[c(501:9500)]) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_raw<-tibble(Developed = c(dat_d$Stability,NA),Forest = dat_f$Stability) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")
dat_sig<-tibble(Developed = c(dat_d$p_sig,NA),Forest = dat_f$p_sig) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Sig")
dat_raw<-dat_raw %>% add_column(Sig = dat_sig$Sig); rm(dat_sig)

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_raw$Sig<-dat_raw$Sig %>% as.character() %>% parse_factor(levels = c('0','1'),include_na = F)

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "Extent of Change") + 
  geom_hline(yintercept = 0,lty = 2,alpha=0.5) +
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Sig),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Landuse),
                       alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_shape_manual(values = c(8,2)) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),0)) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_hline(yintercept = 0,lty = 2,alpha=0.5) +
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity", alpha=0.75) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),0)) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_d<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_d
```

No difference.

# Multipanel figure

```{r}
(Panel_a | Panel_b) / (Panel_c | Panel_d)
rm(Panel_a,Panel_b,Panel_c,Panel_d)
```

## Species comparisons

# Baseline vs Species

```{r}
# subset dataframe
dat_c<-tidy.stability_bird %>%
  filter(Species_ID %in% "Corvus_macrorhynchos" & Cutoff %in% 0.5 & Stability_dimension %in% 'Baseline') 
dat_h<-tidy.stability_bird %>%
  filter(Species_ID %in% "Horornis_diphone" & Cutoff %in% 0.5 & Stability_dimension %in% 'Baseline') 
dat_o<-tidy.stability_bird %>%
  filter(Species_ID %in% "Otus_elegans" & Cutoff %in% 0.5 & Stability_dimension %in% 'Baseline') 
dat_c<-dat_c[complete.cases(dat_c),]
dat_h<-dat_h[complete.cases(dat_h),]
dat_o<-dat_o[complete.cases(dat_o),]

# bootstrap group means & order results
boot_c<-dat_c$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_c<-boot_c$t %>% sort()
boot_h<-dat_h$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_h<-boot_h$t %>% sort()
boot_o<-dat_o$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_o<-boot_o$t %>% sort()

# combine data
dat_sim<-tibble(Corvus = boot_c[c(501:9500)], # choose only 95% CIs
                Horornis = boot_h[c(501:9500)],
                Otus = boot_o[c(501:9500)]) %>%  
  pivot_longer(cols = c('Corvus','Horornis','Otus'),names_to = "Species_ID",values_to = "Bootstrap")
dat_raw<-tibble(Corvus = dat_c$Stability,Horornis = c(dat_h$Stability,NA,NA,NA,NA),
                Otus = c(dat_o$Stability,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA)) %>%  
  pivot_longer(cols = c('Corvus','Horornis','Otus'),names_to = "Species_ID",values_to = "Stability")

# convert to factor
dat_raw$Species_ID<-dat_raw$Species_ID %>% parse_character() %>% parse_factor(levels = c('Corvus','Horornis','Otus'))
dat_sim$Species_ID<-dat_sim$Species_ID %>% parse_character() %>% parse_factor(levels = c('Corvus','Horornis','Otus'))

# Analysis
dat_sim %>% 
  filter(Species_ID == 'Corvus') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Species_ID == 'Horornis') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Species_ID == 'Otus') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Species",y = "Pre-typhoon baseline") + 
  geom_point(mapping = aes(x = Species_ID, y=Stability,
                           shape = Species_ID),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Species_ID, y=Stability,
                             fill = Species_ID),
                       alpha = 0.6) +
  scale_color_manual(values = c('#4682B4','#CD9B1D','#6E8B3D'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Species_ID),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#4682B4','#CD9B1D','#6E8B3D'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_a<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_c,boot_h,boot_o,dat_c,dat_h,dat_o,dat_raw,dat_sim)
Panel_a
```

Corvus and Horornis differ.

# Post-typhoon vs Species

```{r}
# subset dataframe
dat_c<-tidy.stability_bird %>%
  filter(Species_ID %in% "Corvus_macrorhynchos" & Cutoff %in% 0.5 & Stability_dimension %in% 'Mean_post') 
dat_h<-tidy.stability_bird %>%
  filter(Species_ID %in% "Horornis_diphone" & Cutoff %in% 0.5 & Stability_dimension %in% 'Mean_post') 
dat_o<-tidy.stability_bird %>%
  filter(Species_ID %in% "Otus_elegans" & Cutoff %in% 0.5 & Stability_dimension %in% 'Mean_post') 
dat_c<-dat_c[complete.cases(dat_c),]
dat_h<-dat_h[complete.cases(dat_h),]
dat_o<-dat_o[complete.cases(dat_o),]

# bootstrap group means & order results
boot_c<-dat_c$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_c<-boot_c$t %>% sort()
boot_h<-dat_h$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_h<-boot_h$t %>% sort()
boot_o<-dat_o$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_o<-boot_o$t %>% sort()

# combine data
dat_sim<-tibble(Corvus = boot_c[c(501:9500)], # choose only 95% CIs
                Horornis = boot_h[c(501:9500)],
                Otus = boot_o[c(501:9500)]) %>%  
  pivot_longer(cols = c('Corvus','Horornis','Otus'),names_to = "Species_ID",values_to = "Bootstrap")
dat_raw<-tibble(Corvus = dat_c$Stability,Horornis = c(dat_h$Stability,NA,NA,NA,NA),
                Otus = c(dat_o$Stability,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA)) %>%  
  pivot_longer(cols = c('Corvus','Horornis','Otus'),names_to = "Species_ID",values_to = "Stability")

# convert to factor
dat_raw$Species_ID<-dat_raw$Species_ID %>% parse_character() %>% parse_factor(levels = c('Corvus','Horornis','Otus'))
dat_sim$Species_ID<-dat_sim$Species_ID %>% parse_character() %>% parse_factor(levels = c('Corvus','Horornis','Otus'))

# Analysis
dat_sim %>% 
  filter(Species_ID == 'Corvus') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Species_ID == 'Horornis') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Species_ID == 'Otus') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Species",y = "Post-typhoon avg. detections") + 
  geom_point(mapping = aes(x = Species_ID, y=Stability,
                           shape = Species_ID),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Species_ID, y=Stability,
                             fill = Species_ID),
                       alpha = 0.6) +
  scale_color_manual(values = c('#4682B4','#CD9B1D','#6E8B3D'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Species_ID),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#4682B4','#CD9B1D','#6E8B3D'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_b<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_c,boot_h,boot_o,dat_c,dat_h,dat_o,dat_raw,dat_sim)
Panel_b
```

All species differ.

# Temporal Stability vs Species

```{r}
# subset dataframe
dat_c<-tidy.stability_bird %>%
  filter(Species_ID %in% "Corvus_macrorhynchos" & Cutoff %in% 0.5 & Stability_dimension %in% 'Temp_Var') 
dat_h<-tidy.stability_bird %>%
  filter(Species_ID %in% "Horornis_diphone" & Cutoff %in% 0.5 & Stability_dimension %in% 'Temp_Var') 
dat_o<-tidy.stability_bird %>%
  filter(Species_ID %in% "Otus_elegans" & Cutoff %in% 0.5 & Stability_dimension %in% 'Temp_Var') 
dat_c<-dat_c[complete.cases(dat_c),]
dat_h<-dat_h[complete.cases(dat_h),]
dat_o<-dat_o[complete.cases(dat_o),]

# bootstrap group means & order results
boot_c<-dat_c$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_c<-boot_c$t %>% sort()
boot_h<-dat_h$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_h<-boot_h$t %>% sort()
boot_o<-dat_o$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_o<-boot_o$t %>% sort()

# combine data
dat_sim<-tibble(Corvus = boot_c[c(501:9500)], # choose only 95% CIs
                Horornis = boot_h[c(501:9500)],
                Otus = boot_o[c(501:9500)]) %>%  
  pivot_longer(cols = c('Corvus','Horornis','Otus'),names_to = "Species_ID",values_to = "Bootstrap")
dat_raw<-tibble(Corvus = dat_c$Stability,Horornis = c(dat_h$Stability,NA,NA,NA,NA),
                Otus = c(dat_o$Stability,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA)) %>%  
  pivot_longer(cols = c('Corvus','Horornis','Otus'),names_to = "Species_ID",values_to = "Stability")

# convert to factor
dat_raw$Species_ID<-dat_raw$Species_ID %>% parse_character() %>% parse_factor(levels = c('Corvus','Horornis','Otus'))
dat_sim$Species_ID<-dat_sim$Species_ID %>% parse_character() %>% parse_factor(levels = c('Corvus','Horornis','Otus'))

# Analysis
dat_sim %>% 
  filter(Species_ID == 'Corvus') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Species_ID == 'Horornis') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Species_ID == 'Otus') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Species",y = "1 - Temporal Variability") + 
  geom_point(mapping = aes(x = Species_ID, y=Stability,
                           shape = Species_ID),
                     position = position_jitter(width = 0.35),
                     size = 2,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Species_ID, y=Stability,
                             fill = Species_ID),
                       alpha = 0.6) +
  scale_color_manual(values = c('#4682B4','#CD9B1D','#6E8B3D'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Species_ID),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#4682B4','#CD9B1D','#6E8B3D'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_c<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_c,boot_h,boot_o,dat_c,dat_h,dat_o,dat_raw,dat_sim)
Panel_c
```

No difference.

# Extent of Change vs Species

```{r}
# subset dataframe
dat_c<-tidy.stability_bird %>%
  filter(Species_ID %in% "Corvus_macrorhynchos" & Cutoff %in% 0.5 & Stability_dimension %in% 'Ext_Chng') 
dat_h<-tidy.stability_bird %>%
  filter(Species_ID %in% "Horornis_diphone" & Cutoff %in% 0.5 & Stability_dimension %in% 'Ext_Chng') 
dat_o<-tidy.stability_bird %>%
  filter(Species_ID %in% "Otus_elegans" & Cutoff %in% 0.5 & Stability_dimension %in% 'Ext_Chng') 
dat_c<-dat_c[complete.cases(dat_c),]
dat_h<-dat_h[complete.cases(dat_h),]
dat_o<-dat_o[complete.cases(dat_o),]

# bootstrap group means & order results
boot_c<-dat_c$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_c<-boot_c$t %>% sort()
boot_h<-dat_h$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_h<-boot_h$t %>% sort()
boot_o<-dat_o$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_o<-boot_o$t %>% sort()

# combine data
dat_sim<-tibble(Corvus = boot_c[c(501:9500)], # choose only 95% CIs
                Horornis = boot_h[c(501:9500)],
                Otus = boot_o[c(501:9500)]) %>%  
  pivot_longer(cols = c('Corvus','Horornis','Otus'),names_to = "Species_ID",values_to = "Bootstrap")
dat_raw<-tibble(Corvus = dat_c$Stability,Horornis = c(dat_h$Stability,NA,NA,NA,NA),
                Otus = c(dat_o$Stability,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA)) %>%  
  pivot_longer(cols = c('Corvus','Horornis','Otus'),names_to = "Species_ID",values_to = "Stability")
dat_sig<-tibble(Corvus = dat_c$p_sig,Horornis = c(dat_h$p_sig,NA,NA,NA,NA),
                Otus = c(dat_o$p_sig,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA)) %>%  
  pivot_longer(cols = c('Corvus','Horornis','Otus'),names_to = "Species_ID",values_to = "Sig")
dat_raw<-dat_raw %>% add_column(Sig = dat_sig$Sig); rm(dat_sig)

# convert to factor
dat_raw$Species_ID<-dat_raw$Species_ID %>% parse_character() %>% parse_factor(levels = c('Corvus','Horornis','Otus'))
dat_sim$Species_ID<-dat_sim$Species_ID %>% parse_character() %>% parse_factor(levels = c('Corvus','Horornis','Otus'))
dat_raw$Sig<-dat_raw$Sig %>% as.character() %>% parse_factor(levels = c('0','1'),include_na = F)

# Analysis
dat_sim %>% 
  filter(Species_ID == 'Corvus') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Species_ID == 'Horornis') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Species_ID == 'Otus') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Species",y = "Extent of Change") + 
  geom_hline(yintercept = 0,lty = 2,alpha=0.5) +
  geom_point(aes(x = Species_ID, y=Stability,shape = Sig),
             position = position_jitter(width = 0.35),
             size = 2) + 
  geom_boxplot(mapping = aes(x = Species_ID, y=Stability,
                             fill = Species_ID),
                       alpha = 0.6) +
  scale_color_manual(values = c('#4682B4','#CD9B1D','#6E8B3D'),aesthetics = c('colour','fill')) +
  scale_shape_manual(values = c(2,8)) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_hline(yintercept = 0,lty = 2,alpha=0.5) +
  geom_histogram(aes(y=Bootstrap,
                 fill = Species_ID),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#4682B4','#CD9B1D','#6E8B3D'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_d<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
#rm(plot_raw,plot_sim,boot_c,boot_h,boot_o,dat_c,dat_h,dat_o,dat_raw,dat_sim)
Panel_d
```

No difference.

# Multipanel figure

```{r}
(Panel_a | Panel_b) / (Panel_c | Panel_d)
rm(Panel_a,Panel_b,Panel_c,Panel_d)
```

## Bird spatial variability 

# Spatial Variability vs time period

```{r}
# subset dataframe
dat_pre<-tidy.spatial_bird %>%
  filter(Stability_dimension %in% 'Spatial_Var' & Period %in% 'Pre-typhoon') 
dat_post<-tidy.spatial_bird %>%
  filter(Stability_dimension %in% 'Spatial_Var' & Period %in% 'Post-typhoon')
dat_pre<-dat_pre[complete.cases(dat_pre),]
dat_post<-dat_post[complete.cases(dat_post),]

# bootstrap group means & order results
boot_pre<-dat_pre$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_pre<-boot_pre$t %>% sort()
boot_post<-dat_post$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_post<-boot_post$t %>% sort()

# combine data
dat_sim<-tibble('Pre-typhoon' = boot_pre[c(501:9500)], # choose only 95% CIs
                'Post-typhoon' = boot_post[c(501:9500)]) %>%  
  pivot_longer(cols = c('Pre-typhoon','Post-typhoon'),names_to = "Period",values_to = "Bootstrap")
dat_raw<-tibble('Pre-typhoon' = dat_pre$Stability,
                'Post-typhoon' = dat_post$Stability) %>%  
  pivot_longer(cols = c('Pre-typhoon','Post-typhoon'),names_to = "Period",values_to = "Stability")

# convert to factor
dat_raw$Period<-dat_raw$Period %>% parse_character() %>% parse_factor(levels = c('Pre-typhoon','Post-typhoon'))
dat_sim$Period<-dat_sim$Period %>% parse_character() %>% parse_factor(levels = c('Pre-typhoon','Post-typhoon'))

# Analysis
dat_sim %>% 
  filter(Period == 'Pre-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Period == 'Post-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Typhoon Period",y = "Spatial Variability") + 
  geom_point(mapping = aes(x = Period, y=Stability,
                           shape = Period),
                     position = position_jitter(width = 0.35),
                     size = 2, alpha = 0.5,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Period, y=Stability,
                             fill = Period),
                       alpha = 0.6) +
  scale_color_manual(values = c('#00B2EE','#EE6AA7'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Period),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#00B2EE','#EE6AA7'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_a<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_pre,boot_post,dat_pre,dat_post,dat_raw,dat_sim)
Panel_a
```

No effect.

# Spatial Variability vs land use

```{r}
# subset dataframe
dat_f<-tidy.spatial_bird %>%
  filter(Stability_dimension %in% 'Forest_Var' & Period %in% c('Pre-typhoon','Post-typhoon'))
dat_d<-tidy.spatial_bird %>%
  filter(Stability_dimension %in% 'Developed_Var' & Period %in% c('Pre-typhoon','Post-typhoon'))
dat_f<-dat_f[complete.cases(dat_f),]
dat_d<-dat_d[complete.cases(dat_d),]

# bootstrap group means & order results
boot_f<-dat_f$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f<-boot_f$t %>% sort()
boot_d<-dat_d$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d<-boot_d$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f[c(501:9500)], # choose only 95% CIs
                Developed = boot_d[c(501:9500)]) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_raw<-tibble(Forest = dat_f$Stability,
                Developed = c(dat_d$Stability,rep(NA,60))) %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "Spatial Variability") + 
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Landuse),
                     position = position_jitter(width = 0.35),
                     size = 2, alpha = 0.5,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Landuse),
                       alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_b<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_b
```

No effect.

# Spatial Variability vs Time period x Landuse

```{r}
# subset dataframe
dat_f_pre<-tidy.spatial_bird %>%
  filter(Stability_dimension %in% 'Forest_Var' & Period %in% c('Pre-typhoon'))
dat_f_post<-tidy.spatial_bird %>%
  filter(Stability_dimension %in% 'Forest_Var' & Period %in% c('Post-typhoon'))
dat_d_pre<-tidy.spatial_bird %>%
  filter(Stability_dimension %in% 'Developed_Var' & Period %in% c('Pre-typhoon'))
dat_d_post<-tidy.spatial_bird %>%
  filter(Stability_dimension %in% 'Developed_Var' & Period %in% c('Post-typhoon'))
dat_f_pre<-dat_f_pre[complete.cases(dat_f_pre),]
dat_f_post<-dat_f_post[complete.cases(dat_f_post),]
dat_d_pre<-dat_d_pre[complete.cases(dat_d_pre),]
dat_d_post<-dat_d_post[complete.cases(dat_d_post),]

# bootstrap group means & order results
boot_f_pre<-dat_f_pre$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f_pre<-boot_f_pre$t %>% sort()
boot_f_post<-dat_f_post$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_f_post<-boot_f_post$t %>% sort()
boot_d_pre<-dat_d_pre$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d_pre<-boot_d_pre$t %>% sort()
boot_d_post<-dat_d_post$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_d_post<-boot_d_post$t %>% sort()

# combine data
dat_sim<-tibble(Forest = boot_f_pre[c(501:9500)], # choose only 95% CIs
                Developed = boot_d_pre[c(501:9500)], 
                Period = "Pre-typhoon") %>%  # pre-typhoon period
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_sim2<-tibble(Forest = boot_f_post[c(501:9500)], # choose only 95% CIs
                Developed = boot_d_post[c(501:9500)], 
                Period = "Post-typhoon") %>%  # post-typhoon period
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Bootstrap")
dat_sim<-dat_sim %>% add_row(dat_sim2); rm(dat_sim2)
dat_raw<-tibble(Forest = dat_f_pre$Stability,
                Developed = c(dat_d_pre$Stability,rep(NA,30)), 
                Period = "Pre-typhoon") %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")
dat_raw2<-tibble(Forest = dat_f_post$Stability,
                Developed = c(dat_d_post$Stability,rep(NA,30)), 
                Period = "Post-typhoon") %>%  
  pivot_longer(cols = c('Forest','Developed'),names_to = "Landuse",values_to = "Stability")
dat_raw<-dat_raw %>% add_row(dat_raw2); rm(dat_raw2)

# convert to factor
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_raw$Period<-dat_raw$Period %>% parse_character() %>% parse_factor(levels = c('Pre-typhoon','Post-typhoon'))
dat_sim$Period<-dat_sim$Period %>% parse_character() %>% parse_factor(levels = c('Pre-typhoon','Post-typhoon'))

# Analysis
dat_sim %>% 
  filter(Landuse == 'Forest',
         Period == 'Pre-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Forest',
         Period == 'Post-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed',
         Period == 'Pre-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Landuse == 'Developed',
         Period == 'Post-typhoon') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Landuse",y = "Spatial Variability") + 
  geom_point(mapping = aes(x = Landuse, y=Stability,
                           shape = Landuse,group = Period),
                     position = position_jitterdodge(0.6),
                     size = 2, alpha = 0.5,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Landuse, y=Stability,
                             fill = Period),
                       alpha = 0.6) +
  scale_color_manual(values = c('#00B2EE','#EE6AA7'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Period),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#00B2EE','#EE6AA7'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_c<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_d,boot_f,dat_d,dat_f,dat_raw,dat_sim)
Panel_c
```

For bird detections, forests increased post-typhoon while developed sites did not.

# Multipanel figure

```{r}
(Panel_a / Panel_b / Panel_c)
rm(Panel_a,Panel_b,Panel_c)
```


# Spatial Variability vs Species

```{r}
# subset dataframe
dat_c<-tidy.spatial_bird %>%
  filter(Species %in% "Corvus_macrorhynchos" & Stability_dimension %in% 'Spatial_Var') 
dat_h<-tidy.spatial_bird %>%
  filter(Species %in% "Horornis_diphone" & Stability_dimension %in% 'Spatial_Var') 
dat_o<-tidy.spatial_bird %>%
  filter(Species %in% "Otus_elegans" & Stability_dimension %in% 'Spatial_Var') 
dat_c<-dat_c[complete.cases(dat_c),]
dat_h<-dat_h[complete.cases(dat_h),]
dat_o<-dat_o[complete.cases(dat_o),]

# bootstrap group means & order results
boot_c<-dat_c$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_c<-boot_c$t %>% sort()
boot_h<-dat_h$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_h<-boot_h$t %>% sort()
boot_o<-dat_o$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_o<-boot_o$t %>% sort()

# combine data
dat_sim<-tibble(Corvus = boot_c[c(501:9500)], # choose only 95% CIs
                Horornis = boot_h[c(501:9500)],
                Otus = boot_o[c(501:9500)]) %>%  
  pivot_longer(cols = c('Corvus','Horornis','Otus'),names_to = "Species_ID",values_to = "Bootstrap")
dat_raw<-tibble(Corvus = dat_c$Stability,Horornis = dat_h$Stability,
                Otus = c(dat_o$Stability,NA,NA)) %>%  
  pivot_longer(cols = c('Corvus','Horornis','Otus'),names_to = "Species_ID",values_to = "Stability")

# convert to factor
dat_raw$Species_ID<-dat_raw$Species_ID %>% parse_character() %>% parse_factor(levels = c('Corvus','Horornis','Otus'))
dat_sim$Species_ID<-dat_sim$Species_ID %>% parse_character() %>% parse_factor(levels = c('Corvus','Horornis','Otus'))

# Analysis
dat_sim %>% 
  filter(Species_ID == 'Corvus') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Species_ID == 'Horornis') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Species_ID == 'Otus') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Species",y = "Spatial Variability") + 
  geom_point(mapping = aes(x = Species_ID, y=Stability,
                           shape = Species_ID),
                     position = position_jitter(width = 0.35),
                     size = 2, alpha = 0.5,
                     show.legend = FALSE) + 
  geom_boxplot(mapping = aes(x = Species_ID, y=Stability,
                             fill = Species_ID),
                       alpha = 0.6) +
  scale_color_manual(values = c('#4682B4','#CD9B1D','#6E8B3D'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Species_ID),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#4682B4','#CD9B1D','#6E8B3D'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_a<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_c,boot_h,boot_o,dat_c,dat_h,dat_o,dat_raw,dat_sim)
Panel_a
```

# Spatial Variability vs Landuse x Species

```{r}
# subset dataframe
dat_cf<-tidy.spatial_bird %>%
  filter(Species %in% "Corvus_macrorhynchos" & Stability_dimension %in% 'Forest_Var') 
dat_cd<-tidy.spatial_bird %>%
  filter(Species %in% "Corvus_macrorhynchos" & Stability_dimension %in% 'Developed_Var') 
dat_hf<-tidy.spatial_bird %>%
  filter(Species %in% "Horornis_diphone" & Stability_dimension %in% 'Forest_Var') 
dat_hd<-tidy.spatial_bird %>%
  filter(Species %in% "Horornis_diphone" & Stability_dimension %in% 'Developed_Var') 
dat_of<-tidy.spatial_bird %>%
  filter(Species %in% "Otus_elegans" & Stability_dimension %in% 'Forest_Var') 
dat_cf<-dat_cf[complete.cases(dat_cf),]
dat_cd<-dat_cd[complete.cases(dat_cd),]
dat_hf<-dat_hf[complete.cases(dat_hf),]
dat_hd<-dat_hd[complete.cases(dat_hd),]
dat_of<-dat_of[complete.cases(dat_of),]

# bootstrap group means & order results
boot_cf<-dat_cf$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_cf<-boot_cf$t %>% sort()
boot_cd<-dat_cd$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_cd<-boot_cd$t %>% sort()
boot_hf<-dat_hf$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_hf<-boot_hf$t %>% sort()
boot_hd<-dat_hd$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_hd<-boot_hd$t %>% sort()
boot_of<-dat_of$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_of<-boot_of$t %>% sort()

# combine data
dat_sim<-tibble(Corvus = boot_cf[c(501:9500)], # choose only 95% CIs
                Horornis = boot_hf[c(501:9500)],
                Otus = boot_of[c(501:9500)],
                Landuse = "Forest") %>%  
  pivot_longer(cols = c('Corvus','Horornis','Otus'),names_to = "Species_ID",values_to = "Bootstrap")
dat_sim2<-tibble(Corvus = boot_cd[c(501:9500)], # choose only 95% CIs
                Horornis = boot_hd[c(501:9500)],
                Otus = rep(NA,9000),
                Landuse = "Developed") %>%  
  pivot_longer(cols = c('Corvus','Horornis','Otus'),names_to = "Species_ID",values_to = "Bootstrap")
dat_sim<-dat_sim %>% add_row(dat_sim2); rm(dat_sim2)
dat_raw<-tibble(Corvus = dat_cf$Stability,
                Horornis = c(dat_hf$Stability,rep(NA,3)),
                Otus = c(dat_of$Stability,rep(NA,2)),
                Landuse = "Forest") %>%  
  pivot_longer(cols = c('Corvus','Horornis','Otus'),names_to = "Species_ID",values_to = "Stability")
dat_raw2<-tibble(Corvus = dat_cd$Stability,
                 Horornis = c(dat_hd$Stability,NA),
                 Otus = rep(NA,67),
                 Landuse = "Developed") %>%  
  pivot_longer(cols = c('Corvus','Horornis','Otus'),names_to = "Species_ID",values_to = "Stability")
dat_raw<-dat_raw %>% add_row(dat_raw2); rm(dat_raw2)

# convert to factor
dat_raw$Species_ID<-dat_raw$Species_ID %>% parse_character() %>% parse_factor(levels = c('Corvus','Horornis','Otus'))
dat_sim$Species_ID<-dat_sim$Species_ID %>% parse_character() %>% parse_factor(levels = c('Corvus','Horornis','Otus'))
dat_raw$Landuse<-dat_raw$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))
dat_sim$Landuse<-dat_sim$Landuse %>% parse_character() %>% parse_factor(levels = c('Forest','Developed'))

# Analysis
dat_sim %>% 
  filter(Species_ID == 'Corvus',
         Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Species_ID == 'Corvus',
         Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Species_ID == 'Horornis',
         Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Species_ID == 'Horornis',
         Landuse == 'Developed') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Species_ID == 'Otus',
         Landuse == 'Forest') %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Species",y = "Spatial Variability") + 
  geom_point(aes(x = Species_ID, y=Stability,
                 shape = Species_ID,group = Landuse),
                 position = position_jitterdodge(jitter.width = 0.6,dodge.width = 0.9),
             size = 2, alpha = 0.5) + 
  geom_boxplot(mapping = aes(x = Species_ID, y=Stability,
                             fill = Landuse),
               position = position_dodge(0.9,preserve = 'single'),
               alpha = 0.6) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Landuse),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#008B8B','#696969'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_b<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
rm(plot_raw,plot_sim,boot_c,boot_h,boot_o,dat_c,dat_h,dat_o,dat_raw,dat_sim)
Panel_b
```

Across forest sites, all birds differ (Corvus least variable, Otus most). Corvus didn't differ between forest and developed, but Horornis did (more variable in developed sites).

All species differ from each other. Corvus not different between forest and developed, Horornis more variable in developed sites.

# Spatial Variability vs Time period x Species

```{r}
# subset dataframe
dat_c_pre<-tidy.spatial_bird %>%
  filter(Species %in% "Corvus_macrorhynchos" & Stability_dimension %in% 'Spatial_Var' & Period %in% 'Pre-typhoon') 
dat_c_post<-tidy.spatial_bird %>%
  filter(Species %in% "Corvus_macrorhynchos" & Stability_dimension %in% 'Spatial_Var' & Period %in% 'Post-typhoon') 
dat_h_pre<-tidy.spatial_bird %>%
  filter(Species %in% "Horornis_diphone" & Stability_dimension %in% 'Spatial_Var' & Period %in% 'Pre-typhoon') 
dat_h_post<-tidy.spatial_bird %>%
  filter(Species %in% "Horornis_diphone" & Stability_dimension %in% 'Spatial_Var' & Period %in% 'Post-typhoon') 
dat_o_pre<-tidy.spatial_bird %>%
  filter(Species %in% "Otus_elegans" & Stability_dimension %in% 'Spatial_Var' & Period %in% 'Pre-typhoon') 
dat_o_post<-tidy.spatial_bird %>%
  filter(Species %in% "Otus_elegans" & Stability_dimension %in% 'Spatial_Var' & Period %in% 'Post-typhoon') 
dat_c_pre<-dat_c_pre[complete.cases(dat_c_pre),]
dat_c_post<-dat_c_post[complete.cases(dat_c_post),]
dat_h_pre<-dat_h_pre[complete.cases(dat_h_pre),]
dat_h_post<-dat_h_post[complete.cases(dat_h_post),]
dat_o_pre<-dat_o_pre[complete.cases(dat_o_pre),]
dat_o_post<-dat_o_post[complete.cases(dat_o_post),]

# bootstrap group means & order results
boot_c_pre<-dat_c_pre$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_c_pre<-boot_c_pre$t %>% sort()
boot_c_post<-dat_c_post$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_c_post<-boot_c_post$t %>% sort()
boot_h_pre<-dat_h_pre$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_h_pre<-boot_h_pre$t %>% sort()
boot_h_post<-dat_h_post$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_h_post<-boot_h_post$t %>% sort()
boot_o_pre<-dat_o_pre$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_o_pre<-boot_o_pre$t %>% sort()
boot_o_post<-dat_o_post$Stability %>% 
  one.boot(FUN = 'mean',R = 10000,student = F)
boot_o_post<-boot_o_post$t %>% sort()

# combine data
dat_sim<-tibble(Corvus = boot_c_pre[c(501:9500)], # choose only 95% CIs
                Horornis = boot_h_pre[c(501:9500)],
                Otus = boot_o_pre[c(501:9500)],
                Period = "Pre-typhoon") %>%  
  pivot_longer(cols = c('Corvus','Horornis','Otus'),names_to = "Species_ID",values_to = "Bootstrap")
dat_sim2<-tibble(Corvus = boot_c_post[c(501:9500)], # choose only 95% CIs
                Horornis = boot_h_post[c(501:9500)],
                Otus = boot_o_post[c(501:9500)],
                Period = "Post-typhoon") %>%  
  pivot_longer(cols = c('Corvus','Horornis','Otus'),names_to = "Species_ID",values_to = "Bootstrap")
dat_sim<-dat_sim %>% add_row(dat_sim2); rm(dat_sim2)
dat_raw<-tibble(Corvus = dat_c_pre$Stability,
                Horornis = dat_h_pre$Stability,
                Otus = dat_o_pre$Stability,
                Period = "Pre-typhoon") %>%  
  pivot_longer(cols = c('Corvus','Horornis','Otus'),names_to = "Species_ID",values_to = "Stability")
dat_raw2<-tibble(Corvus = dat_c_post$Stability,
                 Horornis = dat_h_post$Stability,
                 Otus = dat_o_post$Stability,
                 Period = "Post-typhoon") %>%  
  pivot_longer(cols = c('Corvus','Horornis','Otus'),names_to = "Species_ID",values_to = "Stability")
dat_raw<-dat_raw %>% add_row(dat_raw2); rm(dat_raw2)

# convert to factor
dat_raw$Species_ID<-dat_raw$Species_ID %>% parse_character() %>% parse_factor(levels = c('Corvus','Horornis','Otus'))
dat_sim$Species_ID<-dat_sim$Species_ID %>% parse_character() %>% parse_factor(levels = c('Corvus','Horornis','Otus'))
dat_raw$Period<-dat_raw$Period %>% parse_character() %>% parse_factor(levels = c('Pre-typhoon','Post-typhoon'))
dat_sim$Period<-dat_sim$Period %>% parse_character() %>% parse_factor(levels = c('Pre-typhoon','Post-typhoon'))

# Analysis
dat_sim %>% 
  filter(Species_ID == 'Corvus',
         Period == "Pre-typhoon") %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Species_ID == 'Corvus',
         Period == "Post-typhoon") %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Species_ID == 'Horornis',
         Period == "Pre-typhoon") %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Species_ID == 'Horornis',
         Period == "Post-typhoon") %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Species_ID == 'Otus',
         Period == "Pre-typhoon") %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))
dat_sim %>% 
  filter(Species_ID == 'Otus',
         Period == "Post-typhoon") %>%
  summarize(Low = min(Bootstrap),
            High = max(Bootstrap))

# Graph
plot_raw<-dat_raw %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Species",y = "Spatial Variability") + 
  geom_point(aes(x = Species_ID, y=Stability,
                 shape = Species_ID,group = Period),
                 position = position_jitterdodge(jitter.width = 0.6,dodge.width = 0.9),
             size = 2, alpha = 0.5) + 
  geom_boxplot(mapping = aes(x = Species_ID, y=Stability,
                             fill = Period),
               position = position_dodge(0.9,preserve = 'single'),
               alpha = 0.6) +
  scale_color_manual(values = c('#00B2EE','#EE6AA7'),aesthetics = c('colour','fill')) +
  ylim(c(dat_raw$Stability %>% min(na.rm = T),
         dat_raw$Stability %>% max(na.rm = T))) +
  theme(legend.position = "none")

plot_sim<-dat_sim %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = element_blank(),y = "95% C.I. of mean bootstrap") + 
  geom_histogram(aes(y=Bootstrap,
                 fill = Period),bins = 250,
                 position="identity", alpha=0.5) +
  scale_color_manual(values = c('#00B2EE','#EE6AA7'),aesthetics = c('colour','fill')) +
  scale_y_continuous(position = "right",
                     limits = c(dat_raw$Stability %>% min(na.rm = T),
                                dat_raw$Stability %>% max(na.rm = T))) + 
  scale_x_continuous(breaks = breaks_pretty(n = 2)) +
  theme(legend.position = "none")

Panel_c<-(plot_raw + plot_sim) + plot_layout(ncol = 2, widths = c(3,1))
#rm(plot_raw,plot_sim,boot_c,boot_h,boot_o,dat_c,dat_h,dat_o,dat_raw,dat_sim)
Panel_c
```

Post-typhoon divergence of Horornis, but not other species. Before typhoon, Corvus and Horornis don't differ, but they do afterwards.

## Multipanel figure

```{r}
(Panel_a / Panel_b / Panel_c)
rm(Panel_a,Panel_b,Panel_c)
```

### Figure S2

Finally, we'll compare the different automatic filtering thresholds for species detection confidence. We'll filter the dataset by only those sites where we have detections for all 3 species (N = 7). 

```{r}

# subset dataframe
ext_chng_all<-tidy.stability_bird %>%
  filter(Stability_dimension %in% 'Ext_Chng') 

ext_chng_all<-ext_chng_all %>% 
  group_by(Site_ID) %>% 
  filter(length(Stability_dimension) == 9)

# convert to factor
ext_chng_all$Site_ID<-ext_chng_all$Site_ID %>% parse_character() %>% parse_factor(ordered = T)
ext_chng_all$Species_ID<-ext_chng_all$Species_ID %>% parse_character() %>% parse_factor(levels = c('Corvus_macrorhynchos','Horornis_diphone','Otus_elegans'))
ext_chng_all$Cutoff<-ext_chng_all$Cutoff %>% as.character() %>% parse_factor(ordered = T)
ext_chng_all$p_sig<-ext_chng_all$p_sig %>% as.character() %>% parse_factor(levels = c('0','1'))

```

Make figure: 

```{r}

ext_chng_all %>% 
  ggplot() + 
  theme_classic(base_size = 14) + 
  labs(x = "Detection confidence threshold",y = "Extent of change") + 
  geom_hline(yintercept = 0,lty = 2,alpha = 0.25) +
  geom_point(aes(x = Cutoff, y=Stability,
                 shape = p_sig, col = Species_ID),
             size = 2.5) + 
  facet_grid(facets = Site_ID ~ Species_ID,scales = 'fixed') + 
  scale_color_manual(values = c('#4682B4','#CD9B1D','#6E8B3D'),aesthetics = c('colour','fill')) +
  scale_shape_manual(values = c(2,8)) + 
  scale_y_continuous(breaks = breaks_pretty(n = 3)) +
  theme(strip.background = element_blank(),
        strip.placement = "outside",
        axis.line.y = element_blank(),
        axis.line.x = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_rect(size=1,colour = "black",fill = F),
        legend.position = "none")

```
